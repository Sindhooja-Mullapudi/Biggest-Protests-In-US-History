(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{fd07:function(e,t,r){"use strict";r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return l})),r.d(t,"j",(function(){return d})),r.d(t,"a",(function(){return k})),r.d(t,"g",(function(){return m})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return _})),r.d(t,"h",(function(){return w})),r.d(t,"i",(function(){return v})),r.d(t,"b",(function(){return T}));var n=r("VtSi"),o=r.n(n),i=r("yHin"),s=r("ZcpU"),a=r("sBNr"),c=r("txt0");function u(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=function(e){var t=encodeURIComponent(e.relativeUrl),r=encodeURIComponent("".concat(e.origin).concat(e.config.BASE_URL,"/oauth-callback?returnURL=").concat(t)),n=e.urlKeyProps?x(e.urlKeyProps.customBaseUrl,e.urlKeyProps.urlKey):e.config.PORTAL_HOST;return"https://".concat(n,"/sharing/rest/oauth2/authorize?client_id=").concat(e.config.OAUTH_CLIENT_ID,"&response_type=token&expiration=20160&redirect_uri=").concat(r,"&showSignupOption=true&force_login=true")},l=function(e){var t=new URL(e.currentUrl),r="https://".concat(t.host).concat(e.config.BASE_URL,"/oauth-callback?returnURL=").concat(encodeURIComponent("/stories")),n=encodeURIComponent(r);if(e.config.PORTAL_HOST.includes("devext.arcgis.com")||e.config.PORTAL_HOST.includes("qaext.arcgis.com")||e.config.PORTAL_HOST.includes("www.arcgis.com")){var o=new URL(e.portal);return o.protocol="https:","".concat(o.origin,"/home/pages/Account/manage_accounts.html#redirect_uri=").concat(n,"&client_id=").concat(e.config.OAUTH_CLIENT_ID)}return"https://".concat(e.config.PORTAL_HOST,"/sharing/rest/oauth2/signout?client_id=").concat(e.config.OAUTH_CLIENT_ID,"&redirect_uri=").concat(n,"&signout=true")},f=function(e){var t=encodeURIComponent(e.redirectUrl),r=new URL(e.portalUrl);return r.protocol="https:",e.isPortal?"".concat(r,"/oauth2/signout?client_id=").concat(e.clientId,"&redirect_uri=").concat(t):"".concat(r.origin,"/home/pages/Account/manage_accounts.html#redirect_uri=").concat(t,"&client_id=").concat(e.clientId,"&signout=true")},d=function(e){var t,n,i,s,a,c;return o.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(t=e.userSession,n=e.config,i=e.isPortal,!t){u.next=12;break}if(s="".concat(n.BASE_URL,"/"),a=window.location.origin+s,c=f({portalUrl:t.portal,redirectUrl:a,clientId:n.OAUTH_CLIENT_ID,isPortal:i}),!v(!1,window.location.href)){u.next=11;break}return u.next=9,o.a.awrap(Promise.all([r.e(1),r.e(55)]).then(r.bind(null,"2ai2")));case 9:u.sent.destroyUserCookie();case 11:window.location.href=c;case 12:case"end":return u.stop()}}),null,null,null,Promise)},k=function(e){var t=e.userCookie,r=e.portalHost,n=e.isPortal,o=y({customBaseUrl:t.customBaseUrl,urlKey:t.urlKey,portalHost:r,isPortal:n});return new i.a({tokenExpires:t.expires?new Date(t.expires):void 0,token:t.token,ssl:!1,username:t.email,portal:o})},m=function(e){var t=Object(a.a)(e,"esri_auth");if(t){var r=JSON.parse(t);if(b(r))return r;c.a.trackEvent(c.a.Category.Story,c.a.Action.Website_AuthCookieInvalid)}},g=function(e){var t=e.basePortalUrl,r=e.userName,n=e.thumbnailUrl,o=e.token;return t&&r&&n&&o?"".concat(t,"/community/users/").concat(r,"/info/").concat(n,"?token=").concat(o):""},_=function(e){var t=e.split("/sharing/rest")[0];return t?"".concat(t,"/home/user.html"):""},w=function(e,t){var r;return o.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o.a.awrap(Object(s.c)("".concat(e.portal,"/oauth2/validateAppAccess"),{authentication:e,params:{client_id:t.OAUTH_CLIENT_ID}}));case 3:return r=n.sent,n.abrupt("return",!!r.valid);case 7:throw n.prev=7,n.t0=n.catch(0),new Error("request-failed");case 10:case"end":return n.stop()}}),null,null,[[0,7]],Promise)},v=function(e,t){try{var r=-1!==new URL(t).hostname.indexOf(".esri.com");return e&&r}catch(n){return!1}},T=function(e){if(e){var t,r={token:"",username:"",expiresAt:new Date(0),isSSLOnly:!1,shouldPersist:!1},n=u(e.substring(1).split("&"));try{for(n.s();!(t=n.n()).done;){var o=t.value.split("="),i=o[0],s=o[1];if(o&&2===o.length)switch(i){case"access_token":r.token=s;break;case"expires_in":/^\d+$/.test(s)&&(r.expiresAt=new Date(1e3*parseInt(s,10)+Date.now()));break;case"username":r.username=decodeURIComponent(s);break;case"ssl":r.isSSLOnly="true"===s;break;case"persist":r.shouldPersist="true"===s}}}catch(a){n.e(a)}finally{n.f()}return r}},y=function(e){var t=e.isPortal||!e.customBaseUrl?e.portalHost:x(e.customBaseUrl,e.urlKey);return"https://".concat(t,"/sharing/rest")},x=function(e,t){return t?"".concat(t,".").concat(e):e},b=function(e){return"string"===typeof e.token&&"string"===typeof e.email}},sBNr:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return a}));var n=r("zjfJ");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var i=function(e,t){var r="",n=e.indexOf(" ".concat(t,"="));if(-1===n&&(n=e.indexOf(t+"=")),-1===n)r="";else{n=e.indexOf("=",n)+1;var o=e.indexOf(";",n);-1===o&&(o=e.length),r=decodeURIComponent(e.substring(n,o))}return r},s=function(e){var t=e.name,r=e.id,i=e.value,s=c(t),a=u(s);try{var p;null===(p=window)||void 0===p||p.localStorage.setItem(s,JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},a,Object(n.a)({},r,i))))}catch(h){}},a=function(e){var t=e.name,r=e.id;return u(c(t))[r]},c=function(e){return"storymaps_".concat(e)},u=function(e){try{var t,r=(null===(t=window)||void 0===t?void 0:t.localStorage.getItem(e))||"{}";return JSON.parse(r)}catch(n){return{}}}},yHin:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r("D57K"),o=r("KA4O"),i=r("R6ly"),s=r("ZcpU");function a(e,t){var r=t;return"undefined"!==typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=s.b,Object(s.c)(e,r)}function c(e,t){var r=t;return r.rawResponse=!1,Object(s.c)(e,r).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),t}))}var u=/^https?:\/\/(\S+)\.arcgis\.com.+/;function p(e){return u.test(e)}function h(e){if(!u.test(e))return null;var t=e.match(u)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function l(e,t){var r=Object(o.a)(function(e){if(!u.test(e))return e;switch(h(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=Object(o.a)(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(r)}var f=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?Object(o.a)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||1440,this.trustedServers={},e.server){var t=this.getServerRootUrl(e.server);this.trustedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return e.beginOAuth2=function(t,r){void 0===r&&(r=window);var o,a=n.a({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",duration:20160,popup:!0,state:t.clientId,locale:""},t),c=a.portal,u=a.provider,p=a.clientId,h=a.duration,l=a.redirectUri,f=a.popup,d=a.state,k=a.locale,m=a.params;if(o="arcgis"===u?c+"/oauth2/authorize?client_id="+p+"&response_type=token&expiration="+h+"&redirect_uri="+encodeURIComponent(l)+"&state="+d+"&locale="+k:c+"/oauth2/social/authorize?client_id="+p+"&socialLoginProviderName="+u+"&autoAccountCreateForSocial=true&response_type=token&expiration="+h+"&redirect_uri="+encodeURIComponent(l)+"&state="+d+"&locale="+k,m&&(o=o+"&"+Object(i.a)(m)),f){var g=function(){var e={promise:null,resolve:null,reject:null};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}();return r["__ESRI_REST_AUTH_HANDLER_"+p]=function(t,r){if(t){var n=JSON.parse(t);g.reject(new s.a(n.errorMessage,n.error))}else if(r){var o=JSON.parse(r);g.resolve(new e({clientId:p,portal:c,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},r.open(o,"oauth-window","height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes"),g.promise}r.location.href=o},e.completeOAuth2=function(t,r){void 0===r&&(r=window);var o=n.a({portal:"https://www.arcgis.com/sharing/rest",popup:!0},t),i=o.portal,a=o.clientId,c=o.popup;function u(t,n){try{var o;if(c&&r.opener&&r.opener.parent&&r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+a])return(o=r.opener.parent["__ESRI_REST_AUTH_HANDLER_"+a])&&o(t?JSON.stringify(t):void 0,JSON.stringify(n)),void r.close();if(c&&r!==r.parent&&r.parent&&r.parent["__ESRI_REST_AUTH_HANDLER_"+a])return(o=r.parent["__ESRI_REST_AUTH_HANDLER_"+a])&&o(t?JSON.stringify(t):void 0,JSON.stringify(n)),void r.close()}catch(u){throw new s.a('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t)throw new s.a(t.errorMessage,t.error);return new e({clientId:a,portal:i,ssl:n.ssl,token:n.token,tokenExpires:n.expires,username:n.username})}var p=r.location.href.match(/access_token=(.+)&expires_in=(.+)&username=([^&]+)/);if(!p){var h=r.location.href.match(/error=(.+)&error_description=(.+)/);return u({error:h[1],errorMessage:decodeURIComponent(h[2])})}var l=p[1],f=new Date(Date.now()+1e3*parseInt(p[2],10)-6e4),d=decodeURIComponent(p[3]);return u(void 0,{token:l,expires:f,ssl:r.location.href.indexOf("&ssl=true")>-1||r.location.href.indexOf("#ssl=true")>-1,username:d})},e.authorize=function(e,t){var r=n.a({portal:"https://arcgis.com/sharing/rest",duration:20160},e),o=r.portal,i=r.clientId,s=r.duration,a=r.redirectUri;t.writeHead(301,{Location:o+"/oauth2/authorize?client_id="+i+"&duration="+s+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var o=n.a({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:1440},t),i=o.portal,s=o.clientId,a=o.redirectUri,u=o.refreshTokenTTL;return c(i+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:s,redirect_uri:a,code:r}}).then((function(t){return new e({clientId:s,portal:i,ssl:t.ssl,redirectUri:a,refreshToken:t.refreshToken,refreshTokenTTL:u,refreshTokenExpires:new Date(Date.now()+1e3*(u-1)),token:t.token,tokenExpires:t.expires,username:t.username})}))},e.deserialize=function(t){var r=JSON.parse(t);return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:t.ssl,token:t.token,username:t.userId,tokenExpires:new Date(t.expires)})},Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!0,configurable:!0}),e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this;if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);var r=this.portal+"/community/self",o=n.a({httpMethod:"GET",authentication:this},e,{rawResponse:!1});return this._pendingUserRequest=Object(s.c)(r,o).then((function(e){return t._user=e,t._pendingUserRequest=null,e})),this._pendingUserRequest},e.prototype.getUsername=function(){return this.username?Promise.resolve(this.username):this._user?Promise.resolve(this._user.username):this.getUser().then((function(e){return e.username}))},e.prototype.getToken=function(e,t){return function(e,t){var r=p(e),n=p(t),o=h(e),i=h(t);return!(!r||!n||o!==i)}(this.portal,e)?this.getFreshToken(t):new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new s.a("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var t=Object(o.a)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),r=(t[0],t[1]),n=t[2].split("/"),i=n[0],s=n.slice(1);return""+r+i.toLowerCase()+"/"+s.join("/")},e.prototype.getTokenForServer=function(e,t){var r=this,n=this.getServerRootUrl(e),o=this.trustedServers[n];return o&&o.expires&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):this._pendingTokenRequests[n]?this._pendingTokenRequests[n]:(this._pendingTokenRequests[n]=Object(s.c)(n+"/rest/info").then((function(o){if(o.owningSystemUrl){if(l(o.owningSystemUrl,r.portal))return Object(s.c)(o.owningSystemUrl+"/sharing/rest/info",t);throw new s.a(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==r.trustedServers[n])return Promise.resolve({authInfo:o.authInfo});throw new s.a(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")})).then((function(e){return e.authInfo.tokenServicesUrl})).then((function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?a(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):a(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then((function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e}))})).then((function(e){return r.trustedServers[n]={expires:new Date(e.expires),token:e.token},delete r._pendingTokenRequests[n],e.token})),this._pendingTokenRequests[n])},e.prototype.getFreshToken=function(e){var t=this;return this.token&&!this.tokenExpires?Promise.resolve(this.token):this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then((function(e){return t._pendingTokenRequests[t.portal]=null,e.token}))),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=n.a({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e);return a(this.portal+"/generateToken",r).then((function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t}))},e.prototype.refreshWithRefreshToken=function(e){var t=this;if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e);var r=n.a({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return c(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t}))},e.prototype.refreshRefreshToken=function(e){var t=this,r=n.a({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return c(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t}))},e}()}}]);