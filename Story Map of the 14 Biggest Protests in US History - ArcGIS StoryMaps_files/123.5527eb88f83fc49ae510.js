(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{wbut:function(e,t,o){"use strict";o.r(t),o.d(t,"VideoBuilder",(function(){return A}));var a=o("cxan"),i=o("9fIP"),r=o("MMYH"),n=o("pWxA"),s=o("K/z8"),c=o("sRHE"),p=o("8K1b"),d=o("zjfJ"),l=o("ERkP"),u=o.n(l),f=o("dua1"),m=o("+L/X"),h=o("2SGB"),b=o("YQpL"),O=o("eCu0"),g=o("2gSQ"),j=o("mmNb"),P=o("ZjWX"),v=o("/StV"),S=o("+PoS"),w=o("cuUk"),C=o("g2IE"),y=o("txt0"),U=o("Tfdo"),I=o("AuFC"),M=o("M6On"),R=o("ew4y"),E=o("7/Cc"),T=o("7Mlx"),k=u.a.createElement;function D(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function F(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?D(Object(o),!0).forEach((function(t){Object(d.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):D(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var A=function(e){Object(p.a)(u,e);var t,o=(t=u,function(){var e,o=Object(c.a)(t);if(V()){var a=Object(c.a)(this).constructor;e=Reflect.construct(o,arguments,a)}else e=o.apply(this,arguments);return Object(s.a)(this,e)});function u(e){var t;return Object(i.a)(this,u),t=o.call(this,e),Object(d.a)(Object(n.a)(t),"videoRef",Object(l.createRef)()),Object(d.a)(Object(n.a)(t),"renderPropertiesModal",(function(){var e={id:"videoAltText",title:t.props.intl.formatMessage({id:"builder.common.altText"}),description:t.props.intl.formatMessage({id:"builder.video.propertiesDescription"}),value:t.state.alt,onChange:t.handleInputChange},o=t.getFocalPointVideoUrl(),a={id:o,customComponent:k(T.a,{mediaType:"video",imageUrl:t.state.videoScreenShotUrl,videoUrl:o,placementType:t.state.mediaPlacement.type,onPlacementTypeUpdate:t.handlePlacementTypeChange,focalPoint:t.state.mediaPlacement.fill,onFocalPointUpdate:t.handleFocalPointChange,canFit:t.props.canFit,showFullScreenPreview:t.props.showFullScreenPlacementPreview,fitColor:t.state.mediaPlacement.fit?t.state.mediaPlacement.fit.color:E.a,onFitColorUpdate:t.handleFitColorChange})},i=[{id:"video-properties",modalProperties:t.props.isCropped?[a,e]:[e]}];return k(P.a,{isShowingModal:t.state.isShowingSettingsModal,mediaTitle:t.props.intl.formatMessage({id:"builder.video.properties"}),tabs:i,onConfirm:t.onPropertiesModalConfirm,onDiscard:t.onPropertiesModalDiscard})})),Object(d.a)(Object(n.a)(t),"videoSrcIsBase64",(function(e){return!!e.match("data:video/mp4;base64")})),Object(d.a)(Object(n.a)(t),"processNewVideo",(function(e){var o=Object(C.a)(e);Object(w.d)(o,"video").isValid?t.uploadVideoFile(o):(window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent),t.setState({isUploading:!1}),t.props.delete())})),Object(d.a)(Object(n.a)(t),"uploadVideoFile",(function(e){var o="".concat(Date.now().toString(),".").concat(e.type.slice(e.type.indexOf("/")+1)),a=t.props.storyItem;if(t.props.isSafari){var i={resourceName:o,resource:e,isAdd:!0};a.upsertItemResource(i).then((function(e){var a=t.props.storyItem.portalUrl,i={src:"https://".concat(a,"/sharing/rest/content/items/").concat(t.props.storyItem.itemId,"/resources/").concat(o),resourceId:o,provider:"item-resource"};t.props.setVideo(i),t.setState({isUploading:!1})})).catch((function(e){t.setState({isUploading:!1}),t.props.toast.add({type:"error",title:k(h.a,{id:"builder.image.uploadErrorTitle"}),details:k(h.a,{id:"builder.video.uploadErrorDescription"})})}))}else{t.props.storyItem.addPendingItemRequest((function(){return new Promise((function(i,r){var n="https://".concat(t.props.config.PORTAL_HOST,"/sharing/rest/content/users/").concat(a.itemOwner,"/items/").concat(t.props.storyItem.itemId,"/addResources?f=json&token=").concat(a.userSession.token),s=new FormData;s.append("file",e,o);var c=new XMLHttpRequest;c.upload.onprogress=function(e){if(t.state.isUploadCancelled)return t.props.delete(),window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent),void t.setState({isUploading:!1});var o=e.loaded/e.total*100;t.setState({progress:o})},c.onload=function(){if(i(),window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent),t.state.isUploadCancelled)t.props.delete();else{t.setState({isUploading:!1});var e={src:"https://".concat(t.props.config.PORTAL_HOST,"/sharing/rest/content/items/").concat(t.props.storyItem.itemId,"/resources/").concat(o),resourceId:o,provider:"item-resource"};t.props.setVideo(e),y.a.trackEvent(y.a.Category.Builder,y.a.Action.Builder_UploadVideo)}},c.onerror=function(e){r(e),window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent),t.setState({isUploading:!1}),t.props.toast.add({type:"error",title:k(h.a,{id:"builder.image.uploadErrorTitle"}),details:k(h.a,{id:"builder.video.uploadErrorDescription"})}),t.props.delete()},c.open("POST",n,!0),c.send(s)}))}))}})),Object(d.a)(Object(n.a)(t),"handleInputChange",(function(e){t.setState({alt:e.target.value})})),Object(d.a)(Object(n.a)(t),"handleFocalPointChange",(function(e){t.setState((function(t){return{mediaPlacement:F({},t.mediaPlacement,{fill:e})}}))})),Object(d.a)(Object(n.a)(t),"handlePlacementTypeChange",(function(e){t.setState((function(t){return{mediaPlacement:F({},t.mediaPlacement,{type:e})}}))})),Object(d.a)(Object(n.a)(t),"handleFitColorChange",(function(e){t.setState((function(t){return{mediaPlacement:F({},t.mediaPlacement,{fit:{color:e}})}}))})),Object(d.a)(Object(n.a)(t),"onPropertiesModalConfirm",(function(){t.updateSettings(),t.closePropertiesModal()})),Object(d.a)(Object(n.a)(t),"onPropertiesModalDiscard",(function(){t.resetSettings(),t.closePropertiesModal()})),Object(d.a)(Object(n.a)(t),"updateSettings",(function(){t.updateAlt(),t.props.updateMediaPlacement(t.state.mediaPlacement)})),Object(d.a)(Object(n.a)(t),"resetSettings",(function(){t.resetAlt(),t.setState({mediaPlacement:t.props.mediaPlacement})})),Object(d.a)(Object(n.a)(t),"updateAlt",(function(){t.props.updateAlt(t.state.alt)})),Object(d.a)(Object(n.a)(t),"resetAlt",(function(){t.setState({alt:t.props.alt})})),Object(d.a)(Object(n.a)(t),"setVideoRef",(function(e){t.videoRef&&(t.videoRef.current=e)})),Object(d.a)(Object(n.a)(t),"openPropertiesModal",(function(){t.videoRef&&t.videoRef.current&&t.videoRef.current.pause();var e=Object(U.a)(t.videoRef);t.setState({isPaused:!0,isShowingSettingsModal:!0,videoScreenShotUrl:e})})),Object(d.a)(Object(n.a)(t),"getFocalPointVideoUrl",(function(){return t.props.resourceId&&t.props.resourceId.length?Object(S.a)({storyItem:t.props.storyItem,fileName:t.props.resourceId,playableMediaType:"video"}):""})),Object(d.a)(Object(n.a)(t),"closePropertiesModal",(function(){t.setState({isShowingSettingsModal:!1,isPaused:!1})})),Object(d.a)(Object(n.a)(t),"cancelUpload",(function(){t.setState({isUploading:!1,isUploadCancelled:!0})})),Object(d.a)(Object(n.a)(t),"defaultWindowUnloadEvent",(function(e){e.preventDefault(),e.returnValue=""})),t.state={alt:t.props.alt,isShowingSettingsModal:!1,isUploading:!(t.props.resourceId||!t.props.src),mediaPlacement:t.props.mediaPlacement,progress:0,isUploadCancelled:!1,videoScreenShotUrl:"",isPaused:!1},t}return Object(r.a)(u,[{key:"componentDidMount",value:function(){var e=this;this.props.src||this.props.resourceId?!this.props.resourceId&&this.props.src&&this.videoSrcIsBase64(this.props.src)&&this.setState({isUploading:!0},(function(){window.addEventListener("beforeunload",e.defaultWindowUnloadEvent),e.processNewVideo(e.props.src)})):this.props.delete()}},{key:"render",value:function(){var e=this.props.showSizeOptions?{full:!0,float:!0,wide:!0,standard:!0}:{full:!1,float:!1,wide:!1,standard:!1},t=k(l.Fragment,null,k(f.default,Object(a.a)({},this.props,{isPlayingBackgroundVideo:("item-resource"===this.props.provider||!this.state.isUploading)&&this.props.isPlayingBackgroundVideo,isPaused:this.state.isPaused,setVideoRef:this.setVideoRef,isUploading:this.state.isUploading,mediaWrapperCaption:k(j.a,{text:this.props.caption||"",placeholder:this.props.intl.formatMessage({id:"builder.video.addCaptionPlaceholder"}),updateCaption:this.props.updateCaption,insertTextBlock:this.props.insertTextBlock,alignmentLg:this.props.captionAlignmentLg,isIntersecting:this.props.isIntersecting,id:this.props.blockId,customCaptionColors:this.props.customCaptionColors,updateCustomCaptionColors:this.props.updateCustomCaptionColors})})),this.renderPropertiesModal(),k(R.a,{mediaName:this.props.name,progress:"".concat(this.state.progress,"%"),isShowing:this.state.isUploading&&!this.props.isSafari,onCancel:this.cancelUpload}));return k(l.Fragment,null,this.props.showFullToolbar?k(v.a,{size:this.props.size,possibleSizes:e,onDeleteClicked:this.props.delete,onSettingsClicked:this.openPropertiesModal,updateSize:this.props.updateSize},t):k(M.a,{onDeleteClicked:this.props.delete,onSettingsClicked:this.openPropertiesModal,thumbnails:this.props.thumbnails,updateOrder:this.props.updateOrder,mediaPanelInserterItems:this.props.mediaPanelInserterItems,isToolbarHidden:!this.props.showControls},t))}},{key:"componentDidUpdate",value:function(e){this.props.alt!==e.alt&&this.setState({alt:this.props.alt}),this.props.mediaPlacement!==e.mediaPlacement&&this.setState({mediaPlacement:this.props.mediaPlacement||E.b})}}]),u}(l.PureComponent);Object(d.a)(A,"defaultProps",{mediaPlacement:E.b}),t.default=Object(I.c)(Object(b.c)(Object(O.c)(Object(m.b)(Object(g.a)(A)))))}}]);