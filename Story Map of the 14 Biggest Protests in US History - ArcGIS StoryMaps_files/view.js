(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{mjBc:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return s}));var n=r("cxan"),a=r("ERkP"),o=r.n(a).a.createElement,i=Object(a.createContext)({areLabFeaturesEnabled:!1}),c=function(t){var e=t.children,r=t.areLabFeaturesEnabled;return o(i.Provider,{value:{areLabFeaturesEnabled:r}},e)},s=function(t){return function(e){return o(i.Consumer,null,(function(r){return o(t,Object(n.a)({},e,r))}))}}},pYoD:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stories/view",function(){return r("uf2o")}])},uDXT:function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r("ERkP"),a=r.n(n),o=r("ysqo"),i=r.n(o),c=r("BVlg"),s=r("Z34l"),u=a.a.createElement,l=function(t,e,r,n,o,l,d){var y="".concat(o?"https://"+o:l.SITE_URL),b=e.snippet?e.snippet.replace(/<[^>]+>/g,""):e.description?e.description.replace(/<[^>]+>/g,""):"",f=Object(s.b)(l.PORTAL_HOST,e,"".concat(y).concat(l.BASE_URL,"/static/images/builder/item/default-thumbnail.jpg")),m=t===c.a.Story?"stories":"collections";return u(i.a,null,u("link",{rel:"alternate",type:"application/json+oembed",href:"".concat(y,"/oembed?url=").concat(encodeURIComponent("".concat(y).concat(l.BASE_URL,"/").concat(m,"/").concat(e.id)),"&format=json"),title:e.title}),u("link",{rel:"alternate",type:"text/xml+oembed",href:"".concat(y,"/oembed?url=").concat(encodeURIComponent("".concat(y).concat(l.BASE_URL,"/").concat(m,"/").concat(e.id)),"&format=xml"),title:e.title}),u("meta",{key:"og:title",property:"og:title",content:e.title}),u("meta",{key:"og:description",property:"og:description",content:b}),u("meta",{key:"og:url",property:"og:url",content:"".concat(y).concat(l.BASE_URL,"/").concat(m,"/").concat(e.id)}),u("meta",{key:"og:image",property:"og:image",content:f}),u("meta",{key:"twitter:creator",name:"twitter:creator",value:r}),u("meta",{key:"twitter:url",name:"twitter:url",value:"".concat(y).concat(l.BASE_URL,"/").concat(m,"/").concat(e.id)}),u("meta",{key:"twitter:title",name:"twitter:title",value:e.title}),u("meta",{key:"twitter:description",name:"twitter:description",value:b}),u("meta",{key:"twitter:image",name:"twitter:image",value:f}),u("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:"".concat(p(m,f,new Date(e.created).toISOString(),n.toISOString(),r,e.title,b,y,e.id,l))}}),d&&u(a.a.Fragment,null,u("script",{async:!0,src:"https://www.googletagmanager.com/gtag/js?id=".concat(d)}),u("script",{dangerouslySetInnerHTML:{__html:"\n              window.dataLayer = window.dataLayer || [];\n              function gtag(){dataLayer.push(arguments);}\n              gtag('js', new Date());\n              gtag('config', '".concat(d,"');")}})))},p=function(t,e,r,n,a,o,i,c,s,u){return JSON.stringify({"@context":"https://schema.org","@type":"NewsArticle",mainEntityOfPage:{"@type":"WebPage","@id":"".concat(c).concat(u.BASE_URL,"/").concat(t,"/").concat(s)},headline:"".concat(o),image:["".concat(e)],datePublished:"".concat(r),dateModified:"".concat(n),author:{"@type":"Person",name:"".concat(a)},publisher:{"@type":"Organization",name:"Esri",logo:{"@type":"ImageObject",url:"".concat(c).concat(u.BASE_URL,"/static/images/story-maps-logo.png")}},description:"".concat(i)})}},uf2o:function(t,e,r){"use strict";r.r(e);var n=r("zygG"),a=r("VtSi"),o=r.n(a),i=r("9fIP"),c=r("pWxA"),s=r("MMYH"),u=r("K/z8"),l=r("sRHE"),p=r("8K1b"),d=r("zjfJ"),y=r("ERkP"),b=r.n(y),f=r("BVlg"),m=r("mjBc"),h=r("Wkul"),g=r("txt0"),v=r("8nAU"),O=r("79uv"),w=r("EP0r"),j=r("fd07"),E=r("MHYw"),P=r("7c6K"),S=r("uDXT"),I=r("wWvE"),A=r("PxFk"),_=r("/E+F"),k=b.a.createElement;function x(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?x(Object(r),!0).forEach((function(e){Object(d.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function L(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}var R=function(t){Object(p.a)(n,t);var e,r=(e=n,function(){var t,r=Object(l.a)(e);if(L()){var n=Object(l.a)(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return Object(u.a)(this,t)});function n(t){var e,a,o;Object(i.a)(this,n),o=r.call(this,t),Object(d.a)(Object(c.a)(o),"storyItem",new f.c({type:f.a.Story,userSession:o.props.userSession,version:"published",storyMapUserPrivileges:o.props.storyMapUserPrivileges,viewerMode:"view",config:o.props.config})),Object(d.a)(Object(c.a)(o),"getStoryByline",(function(t){var e=t.root,r=t.nodes[e];if(!r.data)return"";if(!r.data.children||!r.data.children[0])return"";var n=r.data.children[0],a=t.nodes[n];return a.data&&a.data.byline||""})),Object(d.a)(Object(c.a)(o),"getGAId",(function(t){var e=t.root,r=t.nodes[e];return r&&r.config&&r.config.gaid||""})),Object(d.a)(Object(c.a)(o),"enableAutoplay",(function(){o.setState({isAutoplayEnabled:!0},(function(){Object(_.b)(o.state.autoplaySpeed)}))})),Object(d.a)(Object(c.a)(o),"disableAutoplay",(function(){o.setState({isAutoplayEnabled:!1},(function(){Object(_.b)(void 0,!0)}))})),Object(d.a)(Object(c.a)(o),"onMenuPrint",(function(t){var e;null!==(e=o.props.query)&&void 0!==e&&e.printMode?o.trackActualPrint():(g.a.trackEvent(g.a.Category.Viewer,g.a.Action.Viewer_Print_Preview,g.a.Name.From_Browser_Menu),o.onKeyboardPrint())})),Object(d.a)(Object(c.a)(o),"onKeyboardPrint",(function(t){var e;if(null!==(e=o.props.query)&&void 0!==e&&e.printMode)o.trackActualPrint();else{t&&(t.preventDefault(),g.a.trackEvent(g.a.Category.Builder,g.a.Action.Builder_Print_Preview,g.a.Name.From_Keyboard));var r=o.storyItem.itemDetails.id,n="".concat(o.props.config.SITE_ORIGIN).concat(o.props.config.BASE_URL,"/stories/").concat(r,"/print");Object(w.b)({href:n,isExternal:!0})}})),Object(d.a)(Object(c.a)(o),"trackActualPrint",(function(){g.a.trackEvent(g.a.Category.Viewer,g.a.Action.Viewer_Print)}));var s=null===(e=o.props.query)||void 0===e?void 0:e.speed;return o.state={ready:!Object(v.a)(),isAutoplayEnabled:"string"===typeof(null===(a=o.props.query)||void 0===a?void 0:a.play),autoplaySpeed:"string"!==typeof s||"fast"!==s&&"slow"!==s?"medium":s},o.state.ready&&(o.storyItem.itemId=t.id,o.storyItem.itemDetails=t.itemDetails,o.storyItem.itemData=t.publishedData),o}return Object(s.a)(n,null,[{key:"getInitialProps",value:function(t,e){var r,n,a,i;return o.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r=t.query.id,n=e.userSession,a=e.config,i=e.signInUrl,o.abrupt("return",U({ctx:t,id:r,config:a,userSession:n,signInUrl:i}));case 3:case"end":return o.stop()}}),null,null,null,Promise)}}]),Object(s.a)(n,[{key:"componentDidMount",value:function(){var t,e,r,n,a;return o.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(Object(P.a)({url:this.props.config.ARCGIS_JS_API_URL,locale:this.props.locale}),this.state.ready){i.next=14;break}return i.next=4,o.a.awrap(U({id:null===(t=this.props.query)||void 0===t?void 0:t.id,config:this.props.config,signInUrl:this.props.signInUrl,userSession:this.props.userSession}));case 4:if(e=i.sent,r=e.id,n=e.itemDetails,a=e.publishedData,r){i.next=10;break}return i.abrupt("return");case 10:this.storyItem.itemId=r,this.storyItem.itemDetails=n,this.storyItem.itemData=a,this.setState({ready:!0});case 14:window.addEventListener("beforeprint",this.onMenuPrint);case 15:case"end":return i.stop()}}),null,this,null,Promise)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeprint",this.onMenuPrint)}},{key:"render",value:function(){var t,e,r;return this.state.ready?k(m.a,{areLabFeaturesEnabled:this.props.config.ENABLE_LAB_FEATURES&&"true"===(null===(t=this.props.query)||void 0===t?void 0:t.areLabFeaturesEnabled)},this.storyItem.itemDetails&&this.storyItem&&this.storyItem.itemData&&this.storyItem.getItemPublishDate()&&Object(S.a)(f.a.Story,this.storyItem.itemDetails,this.getStoryByline(this.storyItem.itemData),this.storyItem.getItemPublishDate(),this.props.host,this.props.config,this.getGAId(this.storyItem.itemData)),k(I.a,{origin:this.props.origin,query:this.props.query,id:null===(e=this.props.query)||void 0===e?void 0:e.id,signInUrl:this.props.signInUrl,storyItem:this.storyItem,mode:"view",shouldShowViewerHeader:!this.props.isEmbedded,enableAutoplay:this.enableAutoplay,disableAutoplay:this.disableAutoplay,isAutoplayEnabled:this.state.isAutoplayEnabled,autoplaySpeed:this.state.autoplaySpeed,printMode:null===(r=this.props.query)||void 0===r?void 0:r.printMode}),k(h.a,{triggerKey:"p",isCtrl:!0,isMeta:!0,on:this.onKeyboardPrint})):k(A.a,null)}}]),n}(y.Component);Object(d.a)(R,"requiresAuthentication",!1),Object(d.a)(R,"hideHeaderWhenEmbedded",!0);var U=function(t){var e,r,a,i,c,s,u,l,p,d,y,b,m,h;return o.a.async((function(g){for(;;)switch(g.prev=g.next){case 0:if("string"===typeof t.id){g.next=2;break}throw new Error("no story id");case 2:return e=t.id,r=t.userSession,a=t.config,i=t.ctx,c=t.signInUrl,s={itemId:e,userSession:r,portalHost:a.PORTAL_HOST},u=D({},s,{type:f.a.Story}),g.prev=5,g.next=8,o.a.awrap(Promise.all([f.c.fetchItemDetails(s),f.c.fetchItemData(u)]));case 8:if(l=g.sent,p=Object(n.a)(l,2),d=p[0],y=p[1],Object(O.f)(d)&&Object(w.b)({ctx:i,href:"/stories/edit?id=".concat(e),asPath:"".concat(a.BASE_URL,"/stories/").concat(e,"/edit")}),"public"===d.access||!r){g.next=27;break}return g.prev=14,g.next=17,o.a.awrap(Object(j.h)(r,a));case 17:if(g.sent){g.next=21;break}return Object(w.b)({ctx:i,href:"/error?errType=unsupported-account",asPath:"".concat(a.BASE_URL,"/error?errType=unsupported-account")}),g.abrupt("return",{});case 21:g.next=27;break;case 23:return g.prev=23,g.t0=g.catch(14),Object(w.b)({ctx:i,href:"/error",asPath:"".concat(a.BASE_URL,"/error")}),g.abrupt("return",{});case 27:return b="","undefined"!==typeof i&&(m=i.req,(h=i.res)&&"function"===typeof h.setHeader&&("public"===d.access?h.setHeader("Cache-Control","public, max-age=".concat(a.CACHE_MAX_AGE)):h.setHeader("Cache-Control","private, max-age=".concat(a.NON_PUBLIC_CACHE_MAX_AGE))),b=(null===m||void 0===m?void 0:m.headers.host)||""),g.abrupt("return",{id:e,itemDetails:d,publishedData:y,host:b});case 32:if(g.prev=32,g.t1=g.catch(5),!g.t1||!g.t1.code){g.next=39;break}return Object(E.d)({ctx:i,userSession:r,signInUrl:c,error:g.t1,config:a}),g.abrupt("return",{});case 39:if(!("string"===typeof g.t1.message&&g.t1.message.search("items/".concat(e,"/data"))>=0&&"invalid-json"===g.t1.type)){g.next=42;break}return Object(w.b)({ctx:i,href:"/stories/preview?id=".concat(e),asPath:"".concat(a.BASE_URL,"/stories/").concat(e,"/preview")}),g.abrupt("return",{});case 42:return Object(w.b)({ctx:i,href:"/error",asPath:"".concat(a.BASE_URL,"/error")}),g.abrupt("return",{});case 44:case"end":return g.stop()}}),null,null,[[5,32],[14,23]],Promise)};e.default=R}},[["pYoD",3,2,0,4,5,6,8,9,10,11,14,16,17,23]]]);