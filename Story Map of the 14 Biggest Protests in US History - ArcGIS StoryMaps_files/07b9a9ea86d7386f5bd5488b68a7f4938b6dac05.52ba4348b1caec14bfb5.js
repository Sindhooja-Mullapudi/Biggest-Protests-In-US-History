(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"9Y0E":function(e,t,r){"use strict";var a=r("VtSi"),n=r.n(a),s=r("fGyu"),i=r("9fIP"),o=r("MMYH"),c=r("pWxA"),u=r("K/z8"),l=r("8K1b"),p=r("sRHE"),d=r("PRnZ"),f=r("zjfJ"),b=r("5ts5"),h=r("URUM"),m=r("Gh8D"),S=r("Q1mh"),y=r("vpyF"),v=r("ZcpU"),I=r("g2IE"),g=r("I/HP"),O=r("kO5H"),w=r("Bx5b"),P=r("mvvZ"),D=r("79uv"),j=r("txt0"),x=r("N8kh"),E=r("Z34l"),R=r("n32U"),_=r("sczD"),A=r("RNvQ"),L=r.n(A),U=r("BVlg"),N=function(e){try{var t="collection"===e.type?j.a.Category.Collection:j.a.Category.Story,r="collection"===e.type?j.a.Category.CollectionStatistics:j.a.Category.StoryStatistics;if(j.a.trackEvent(t,j.a.Action.Story_PublishStory,e.firstPublish?j.a.Name.Story_PublishStory_FromDraft:j.a.Name.Story_PublishStory_Republish),e.firstPublish){var a,n=e.licenseType;n||(n=""),a=n.includes("creator")?j.a.Name.Story_PublishStory_UserType_Creator:n.includes("GISProfessional")?j.a.Name.Story_PublishStory_UserType_GISProfessional:n.includes("Storyteller")?j.a.Name.Story_PublishStory_UserType_StoryTeller:j.a.Name.Story_PublishStory_UserType_Public,j.a.trackEvent(t,j.a.Action.Story_PublishStory_UserType,a)}var s=new Date;if(e.firstPublish?j.a.trackEvent(r,j.a.Action.StoryStatistics_FirstPublish_DayOfMonth,s.getDate().toString()):j.a.trackEvent(r,j.a.Action.StoryStatistics_Republish_DayOfMonth,s.getDate().toString()),"story"===e.type){var i={},o=0,c=0;Object.keys(e.itemData.nodes).forEach((function(t){var r=e.itemData.nodes[t];if("immersive-slide"!==r.type&&"immersive-side-panel"!==r.type){if("immersive"===r.type){var a=r.data.type;"sidecar"===a&&(a="floating-panel"===r.data.subtype?"sidecar-float":"sidecar-docked"),r.type=a}if("number"===typeof i[r.type]?i[r.type]=i[r.type]+1:i[r.type]=1,r.data&&"string"===typeof r.data.alt&&(o+=1,r.data.alt.length>0&&(c+=1)),r.data&&("slideshow"===r.type||"sidecar-float"===r.type||"sidecar-docked"===r.type)){var n=r.data.type;j.a.trackEvent(j.a.Category.StoryStatistics,"slideshow"===n?e.firstPublish?j.a.Action.StoryStatistics_Slideshow_FirstPublish_SlidesCount:j.a.Action.StoryStatistics_Slideshow_Republish_SlidesCount:e.firstPublish?j.a.Action.StoryStatistics_SideCar_FirstPublish_SlidesCount:j.a.Action.StoryStatistics_SideCar_Republish_SlidesCount,"slideshow"===n?j.a.Name.Builder_Slideshow:j.a.Name.Builder_Sidecar,r.children?r.children.length:0)}"tour"===r.type&&r.data&&j.a.trackEvent(j.a.Category.StoryStatistics,e.firstPublish?j.a.Action.StoryStatistics_GuidedTour_FirstPublish_SlidesCount:j.a.Action.StoryStatistics_GuidedTour_Republish_SlidesCount,j.a.Name.Builder_GuidedTour,r.data.places?r.data.places.length:0),"credits"===r.type&&r.config&&!r.config.isHidden&&j.a.trackEvent(j.a.Category.StoryStatistics,e.firstPublish?j.a.Action.StoryStatistics_FirstPublish_CreditsToggledOn:j.a.Action.StoryStatistics_Republish_CreditsToggledOn)}}));var u=e.firstPublish?j.a.Action.StoryStatistics_FirstPublish_NodeCount:j.a.Action.StoryStatistics_Republish_NodeCount;Object.keys(i).forEach((function(e){j.a.trackEvent(j.a.Category.StoryStatistics,u,e,i[e])}));var l=e.firstPublish?j.a.Action.StoryStatistics_FirstPublish_AltTextUsed:j.a.Action.StoryStatistics_Republish_AltTextUsed,p=o>0&&c>0,d=Math.round(c/o*100);j.a.trackEvent(j.a.Category.StoryStatistics,l,p.toString(),d)}}catch(f){return}},C=r("JmSK"),G=r("+lMt");function T(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var H=function(e){Object(l.a)(a,e);var t,r=(t=a,function(){var e,r=Object(p.a)(t);if(T()){var a=Object(p.a)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return Object(u.a)(this,e)});function a(e,t){var n;return Object(i.a)(this,a),(n=r.call(this,"Draft data is missing")).itemId=e,t&&(n.recoveryData="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t))),n}return a}(Object(G.a)(Error)),k=r("72yd"),B=r("S15H"),M=r("TLWd"),F=r("R+Fi");function V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){Object(f.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var W,K,J=function(e){return"smdraftrecovery_".concat(e)},z=function(e){var t=J(e),r=window.localStorage.getItem(t);return JSON.parse(r)},Z=function(e,t){try{var r=J(e),a=z(e);if(a&&(!t||!a.downloaded))return Object(I.b)(a.data,"StoryMap_Draft_Recovery_".concat(e)),window.localStorage.setItem(r,JSON.stringify(q({},a,{downloaded:!0}))),!0}catch(n){}return!1};!function(e){e[e.DRAFT_SAVE=0]="DRAFT_SAVE",e[e.PUBLISHING=1]="PUBLISHING",e[e.UNPUBLISHING=2]="UNPUBLISHING",e[e.DISCARDING_UNPUBLISHED_CHANGES=3]="DISCARDING_UNPUBLISHED_CHANGES"}(W||(W={})),function(e){e.DRAFT="draft",e.PUBLISHED="published"}(K||(K={}));var Q=function(e){Object(l.a)(a,e);var t,r=(t=a,function(){var e,r=Object(p.a)(t);if(V()){var a=Object(p.a)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return Object(u.a)(this,e)});function a(e){var t;return Object(i.a)(this,a),t=r.call(this,e),Object(f.a)(Object(c.a)(t),"itemDraftDataJSON",""),Object(f.a)(Object(c.a)(t),"storySaveStatus",!1),Object(f.a)(Object(c.a)(t),"isPublishWorkflowLocked",!1),Object(f.a)(Object(c.a)(t),"autosaveStory",L()((function(){return t.saveStory()}),1e3,{maxWait:1e4})),Object(f.a)(Object(c.a)(t),"getItemPublishDate",(function(){return t.getItemPublishStatus()===C.c.published&&Object(d.a)(Object(p.a)(a.prototype),"getItemPublishDate",Object(c.a)(t)).call(Object(c.a)(t))})),Object(f.a)(Object(c.a)(t),"saveStory",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DRAFT_SAVE;if(t.storySaveStatus)return new Promise((function(r,a){var n=function(){t.saveStory(e).then(r).catch(a)};t.storySaveStatus.then(n).catch(n)}));var r=function(){var r,a,i,o,c,u,l,p,d;return n.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:f.prev=0,t.emit("story-save-start"),t.isPublishWorkflowLocked||window.addEventListener("beforeunload",t.defaultWindowUnloadEvent),t.updateDataAndDetails(e),e===W.DRAFT_SAVE&&t.getItemPublishStatus()===C.c.published?t.setItemPublishStatus(C.c.unpublishedChanges):e===W.DISCARDING_UNPUBLISHED_CHANGES?(t.setItemPublishStatus(C.c.published),t.setItemDraftData(t.itemData)):e===W.PUBLISHING?(t.setItemPublishStatus(C.c.published),t.setItemPublishDate(new Date),t.updateAppVersion(W.PUBLISHING),t.setItemData(t.itemDraftData)):e===W.UNPUBLISHING&&(t.setItemPublishStatus(C.c.draft),t.setItemPublishDate("remove"),t.updateAppVersion(W.UNPUBLISHING),t.setItemData({unpublished:!0}),r=t.itemDetails.typeKeywords.filter((function(e){return!e.match("Copy Item")})),t.setItemDetails(q({},t.itemDetails,{typeKeywords:Object(s.a)(r)}))),t.updateAppVersion(),a=Object(g.b)(t.itemDetails),i="draft_".concat(Date.now(),".json");try{o={timestamp:Date.now(),downloaded:!1,data:t.itemDraftData},window.localStorage.setItem(J(t.itemId),JSON.stringify(o))}catch(h){}return f.next=11,n.a.awrap(t.upsertItemResource({isPublished:!1,isAdd:!0,resourceName:i,resource:Object(I.c)(t.itemDraftData)}));case 11:c=f.sent;try{t.upsertItemResource({isRemove:!0,resourceName:a})}catch(m){}return t.setItemDetails(Object(O.c)({itemDetails:t.itemDetails,typekeywordId:w.a,data:i})),u=function(){return n.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(b.a)({authentication:t.userSession,item:t.itemDetails,params:{text:e===W.PUBLISHING||e===W.UNPUBLISHING?t.itemData:void 0}}));case 1:case"end":return r.stop()}}),null,null,null,Promise)},l=t.addPendingItemRequest(u),f.next=18,n.a.awrap(l);case 18:return p=f.sent,d=[c,p],t.onSaveEnd(void 0,d),f.abrupt("return",d);case 24:throw f.prev=24,f.t0=f.catch(0),t.onSaveEnd(f.t0,void 0),f.t0;case 28:case"end":return f.stop()}}),null,null,[[0,24]],Promise)};return t.storySaveStatus=r(),t.storySaveStatus})),Object(f.a)(Object(c.a)(t),"upsertItemResource",(function(e,r){var a;return n.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(a=function(){var r,a,s,i,o,c,u,l;return n.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(r=e.userSession||t.userSession){p.next=3;break}throw new Error("no user session");case 3:if(a=function(a){return q({},{authentication:r,id:t.itemId,name:e.resourceName,resource:e.resource,owner:t.itemOwner,private:!0!==e.isPublished},{},e.options)},!0!==e.isAdd){p.next=11;break}return p.next=7,n.a.awrap(Object(h.a)(a(!0)));case 7:return s=p.sent,p.abrupt("return",s);case 11:if(!1!==e.isAdd){p.next=18;break}return p.next=14,n.a.awrap(Object(b.b)(a(!1)));case 14:return i=p.sent,p.abrupt("return",i);case 18:if(!0!==e.isRemove){p.next=26;break}return o=a(!1),p.next=22,n.a.awrap(Object(m.b)({authentication:o.authentication,id:o.id,resource:o.name,owner:o.owner}));case 22:return c=p.sent,p.abrupt("return",c);case 26:return p.prev=26,p.next=29,n.a.awrap(Object(b.b)(a(!1)));case 29:if(!(u=p.sent).success){p.next=32;break}return p.abrupt("return",u);case 32:throw u;case 35:return p.prev=35,p.t0=p.catch(26),p.next=39,n.a.awrap(Object(h.a)(a(!0)));case 39:return l=p.sent,p.abrupt("return",l);case 41:case"end":return p.stop()}}),null,null,[[26,35]],Promise)},!r){s.next=3;break}return s.abrupt("return",a());case 3:return s.abrupt("return",t.addPendingItemRequest(a));case 4:case"end":return s.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"addPendingItemRequest",(function(e){var r=Object(P.e)(t.pendingItemRequests).then(e);return t.pendingItemRequests=r,r})),Object(f.a)(Object(c.a)(t),"shareStory",(function(e){var r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return r=function(){var r,a,i,o,c,u,l,p,d,f,b,h,m,v,I;return n.a.async((function(g){for(;;)switch(g.prev=g.next){case 0:return o=e?e.access:t.itemSharingLevel.access,c=e?e.groups||[]:t.itemSharingLevel.groups||[],g.next=4,n.a.awrap(Object(D.d)({itemDetails:t.itemDetails,userSession:t.userSession}));case 4:return u=g.sent,g.t0=[],g.next=8,n.a.awrap(null===(a=t.userSession)||void 0===a?void 0:a.getUser());case 8:if(g.t3=r=g.sent,g.t2=null===g.t3,g.t2){g.next=12;break}g.t2=void 0===r;case 12:if(!g.t2){g.next=16;break}g.t4=void 0,g.next=17;break;case 16:g.t4=r.groups;case 17:if(g.t1=g.t4,g.t1){g.next=20;break}g.t1=[];case 20:return g.t5=g.t1,l=g.t0.concat.call(g.t0,g.t5).reduce((function(e,t){return e[t.id]=t,e}),{}),g.next=24,n.a.awrap(null===(i=t.userSession)||void 0===i?void 0:i.getUser());case 24:return p=g.sent,d=null===p||void 0===p?void 0:p.favGroupId,f=u.filter((function(e){return e!==d&&!(null===c||void 0===c?void 0:c.includes(e))&&Object(B.a)(l[e],!1)})),b=c.filter((function(e){return e!==d&&!(null===u||void 0===u?void 0:u.includes(e))&&Object(B.a)(l[e],!1)})),j.a.trackEvent("collection"===t.type?j.a.Category.Collection:j.a.Category.Story,j.a.Action.Story_ShareStory,o),c&&c.length>0&&j.a.trackEvent("collection"===t.type?j.a.Category.Collection:j.a.Category.Story,j.a.Action.Story_ShareStory,j.a.Name.Story_Share_Groups,c.length+1),h=Object(S.a)({id:t.itemId,access:o===x.a.SHARED?x.a.PRIVATE:o,authentication:t.userSession,owner:t.itemOwner}),m=b.map((function(e){return Object(y.a)({id:t.itemDetails.id,groupId:e,confirmItemControl:!1,authentication:t.userSession,owner:t.itemOwner})})),v=f.map((function(e){return Object(y.b)({id:t.itemDetails.id,groupId:e,authentication:t.userSession,owner:t.itemOwner})})),g.next=35,n.a.awrap(Promise.all([h].concat(Object(s.a)(m),Object(s.a)(v))));case 35:if(I=g.sent,o!==x.a.PUBLIC){g.next=39;break}return g.next=39,n.a.awrap(t.upsertOembedResources(!0));case 39:return g.abrupt("return",I);case 40:case"end":return g.stop()}}),null,null,null,Promise)},a.abrupt("return",t.addPendingItemRequest(r));case 2:case"end":return a.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"publishStory",(function(){var e,r,a,s,i,o,c;return n.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(!t.onPublishMethodStart(W.PUBLISHING)){u.next=25;break}return u.prev=1,e=t.getItemPublishStatus()===C.c.draft,u.next=5,n.a.awrap(t.saveStory(W.PUBLISHING));case 5:return r=u.sent,u.next=8,n.a.awrap(t.updateItemResources(W.PUBLISHING));case 8:return a=u.sent,u.next=11,n.a.awrap(t.shareStory());case 11:return s=u.sent,i=[r,a,s],u.next=15,n.a.awrap(t.userSession.getUser());case 15:o=u.sent,c=o.userLicenseTypeId,N({type:t.type,itemDetails:t.itemDetails,itemData:t.itemData,firstPublish:e,licenseType:c}),t.onPublishMethodEnd(W.PUBLISHING,[e,null,i]),u.next=25;break;case 21:throw u.prev=21,u.t0=u.catch(1),t.onPublishMethodEnd(W.PUBLISHING,[!1,u.t0]),new Error(u.t0);case 25:case"end":return u.stop()}}),null,null,[[1,21]],Promise)})),Object(f.a)(Object(c.a)(t),"discardUnpublishedChanges",(function(){var e,r,a;return n.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.onPublishMethodStart(W.DISCARDING_UNPUBLISHED_CHANGES)){s.next=17;break}return s.prev=1,s.next=4,n.a.awrap(t.saveStory(W.DISCARDING_UNPUBLISHED_CHANGES));case 4:return e=s.sent,s.next=7,n.a.awrap(t.updateItemResources(W.DISCARDING_UNPUBLISHED_CHANGES));case 7:r=s.sent,a=[e,r],j.a.trackEvent("collection"===t.type?j.a.Category.Collection:j.a.Category.Story,j.a.Action.Story_DiscardUnpublishedChanges),t.onPublishMethodEnd(W.DISCARDING_UNPUBLISHED_CHANGES,[a]),s.next=17;break;case 13:throw s.prev=13,s.t0=s.catch(1),t.onPublishMethodEnd(W.DISCARDING_UNPUBLISHED_CHANGES,[null,s.t0]),new Error(s.t0);case 17:case"end":return s.stop()}}),null,null,[[1,13]],Promise)})),Object(f.a)(Object(c.a)(t),"unpublishStory",(function(e){var r,a,s,i;return n.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(!t.onPublishMethodStart(W.UNPUBLISHING)){o.next=21;break}return o.prev=1,o.next=4,n.a.awrap(t.saveStory(W.UNPUBLISHING));case 4:return r=o.sent,o.next=7,n.a.awrap(t.updateItemResources(W.UNPUBLISHING));case 7:return a=o.sent,o.next=10,n.a.awrap(t.shareStory({access:x.a.PRIVATE,groups:[]}));case 10:s=o.sent,t.itemSharingLevel={access:x.a.PRIVATE,groups:[]},i=[r,a,s],e||j.a.trackEvent("collection"===t.type?j.a.Category.Collection:j.a.Category.Story,j.a.Action.Story_UnpublishStory),t.onPublishMethodEnd(W.UNPUBLISHING,[i]),o.next=21;break;case 17:throw o.prev=17,o.t0=o.catch(1),t.onPublishMethodEnd(W.UNPUBLISHING,[null,o.t0]),new Error(o.t0);case 21:case"end":return o.stop()}}),null,null,[[1,17]],Promise)})),Object(f.a)(Object(c.a)(t),"hasUnsavedChanges",(function(){return t.itemDraftDataJSON!==JSON.stringify(t.getStoryData().itemData)})),Object(f.a)(Object(c.a)(t),"setGetStoryDataMethod",(function(e){t.getStoryData=e})),Object(f.a)(Object(c.a)(t),"setParseItemResourcesForPublish",(function(e){t.parseItemResourcesForPublish=e})),Object(f.a)(Object(c.a)(t),"setUpdateStoryTitle",(function(e){t.updateStoryTitle=e})),Object(f.a)(Object(c.a)(t),"fetchStoryBuilderData",(function(){var e,r,s,i,o,c;return n.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return e={itemId:t.itemId,userSession:t.userSession,portalHost:t.config.PORTAL_HOST},r=q({},e,{type:t.type}),u.next=4,n.a.awrap(a.fetchItemDetails(e));case 4:if("update"===(s=u.sent).itemControl||"admin"===s.itemControl){u.next=7;break}throw new Error(k.b);case 7:return t.setItemDetails(s),u.next=10,n.a.awrap(Object(D.d)({itemDetails:t.itemDetails,userSession:t.userSession,excludeFavoritesGroup:!0}));case 10:return i=u.sent,t.itemSharingLevel={access:t.itemDetails.access,groups:i},u.next=14,n.a.awrap(a.fetchItemDraftData({itemDetails:t.itemDetails,type:t.type,userSession:t.userSession,portalHost:t.config.PORTAL_HOST}));case 14:if(o=u.sent,t.setItemDraftData(o),t.getItemPublishStatus()===C.c.draft){u.next=21;break}return u.next=19,n.a.awrap(a.fetchItemData(r));case 19:c=u.sent,t.setItemData(c);case 21:case"end":return u.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"isStoryOwner",(function(){var e,r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.a.awrap(null===(e=t.userSession)||void 0===e?void 0:e.getUser());case 2:if((null===(r=a.sent)||void 0===r?void 0:r.username)!==t.itemOwner){a.next=5;break}return a.abrupt("return",!0);case 5:return a.abrupt("return",!1);case 6:case"end":return a.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"duplicateStory",(function(){var e,r,a,s,i;return n.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(Object(F.a)(Object(c.a)(t))){o.next=2;break}throw new Error("User does not have permission to duplicate story");case 2:return o.next=4,n.a.awrap(null===(e=t.userSession)||void 0===e?void 0:e.getUser());case 4:return r=o.sent,a="".concat(Object(E.e)(t.config.PORTAL_HOST,t.userSession),"/content/users/").concat(t.itemOwner,"/items/").concat(t.itemId,"/copy"),o.next=8,n.a.awrap(Object(v.c)(a,{authentication:t.userSession,httpMethod:"POST",params:{includeResources:!0,copyPrivateResources:!0,f:"json"}}));case 8:return s=o.sent,o.next=11,n.a.awrap(t.isStoryOwner());case 11:if(o.sent){o.next=15;break}return i="".concat(Object(E.e)(t.config.PORTAL_HOST,t.userSession),"/content/users/").concat(t.itemOwner,"/items/").concat(s.itemId,"/reassign"),o.next=15,n.a.awrap(Object(v.c)(i,{authentication:t.userSession,httpMethod:"POST",params:{targetUsername:(null===r||void 0===r?void 0:r.username)||t.userSession.username,targetFolderName:"/",f:"json"}}));case 15:return o.abrupt("return",s);case 16:case"end":return o.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"duplicateStoryCleanup",(function(e){var r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.updateDataAndDetails(W.DRAFT_SAVE),(r=e?"".concat(e," ").concat(t.itemDetails.title.substring(0,k.d-e.length+1)):void 0)&&t.updateStoryTitle(r),a.next=5,n.a.awrap(t.unpublishStory(!0));case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"onSaveEnd",(function(e,r,a){t.storySaveStatus=!1,window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent),t.emit("story-save-end",e,r,a)})),Object(f.a)(Object(c.a)(t),"getPublishEventName",(function(e){switch(e){case W.PUBLISHING:return"story-publish";case W.DISCARDING_UNPUBLISHED_CHANGES:return"discard-unpublished-changes";default:return"story-unpublish"}})),Object(f.a)(Object(c.a)(t),"onPublishMethodStart",(function(e){return!t.isPublishWorkflowLocked&&(t.isPublishWorkflowLocked=!0,t.emit("".concat(t.getPublishEventName(e),"-start")),window.addEventListener("beforeunload",t.defaultWindowUnloadEvent),!0)})),Object(f.a)(Object(c.a)(t),"onPublishMethodEnd",(function(e,r){var a;t.isPublishWorkflowLocked=!1,(a=t).emit.apply(a,["".concat(t.getPublishEventName(e),"-end")].concat(Object(s.a)(r))),window.removeEventListener("beforeunload",t.defaultWindowUnloadEvent)})),Object(f.a)(Object(c.a)(t),"getStoryData",(function(){return{itemDetails:{},itemData:{root:"",nodes:{},resources:{}}}})),Object(f.a)(Object(c.a)(t),"parseItemResourcesForPublish",(function(e,t){throw new Error("Story resources not getting parsed.")})),Object(f.a)(Object(c.a)(t),"updateStoryTitle",(function(e){throw new Error("Story title not getting updated.")})),Object(f.a)(Object(c.a)(t),"updateDataAndDetails",(function(e){var r=t.getStoryData();if("undefined"===typeof r)throw new Error("Story data not getting updated.");if(e!==W.PUBLISHING&&e!==W.DRAFT_SAVE||t.setItemDraftData(r.itemData),e===W.PUBLISHING||e===W.UNPUBLISHING||t.getItemPublishStatus()===C.c.draft){var a=q({},t.itemDetails,{},r.itemDetails),n=t.type===U.a.Collection?"collections":"stories";a.title||(a.title=Object(M.a)({type:t.type,dateStamp:a.created})),r.itemDetails.imageResourceId&&(a.thumbnailUrl="".concat(Object(E.e)(t.config.PORTAL_HOST,t.userSession),"/content/items/").concat(t.itemId,"/resources/").concat(r.itemDetails.imageResourceId,"?w=1000&token=").concat(t.userSession.token)),e===W.PUBLISHING?a.url="".concat(window.location.origin).concat(t.config.BASE_URL,"/").concat(n,"/").concat(t.itemId):e===W.UNPUBLISHING&&(a.url=""),a.clearEmptyFields=!0,t.setItemDetails(a)}})),Object(f.a)(Object(c.a)(t),"updateItemResources",(function(e){var r,a,i,o,c,u,l,p,d,f,b,h,m;return n.a.async((function(S){for(;;)switch(S.prev=S.next){case 0:return r=Object(g.b)(t.itemDetails),a=e===W.UNPUBLISHING||e===W.PUBLISHING?t.itemDraftData:void 0,i=e===W.UNPUBLISHING?void 0:t.itemData,o=t.parseItemResourcesForPublish(a,i),S.next=6,n.a.awrap(Object(D.b)({userSession:t.userSession,username:t.itemOwner,itemId:t.itemId,portal:Object(E.e)(t.config.PORTAL_HOST,t.userSession)}));case 6:return c=S.sent,S.next=9,n.a.awrap(t.getResourceIdsFromData(o.publishedItemResources,K.PUBLISHED,e));case 9:return u=S.sent,S.next=12,n.a.awrap(t.getResourceIdsFromData(o.draftItemResources,K.DRAFT,e));case 12:return l=S.sent,p=c.map((function(e){var a=e.resource;if(a!==r)if(u.indexOf(a)>=0){if("inherit"!==e.access)return t.upsertItemResource({isAdd:!1,isPublished:!0,resourceName:a})}else{if(!(l.indexOf(a)>=0))return t.upsertItemResource({isRemove:!0,resourceName:a});if("private"!==e.access)return t.upsertItemResource({isAdd:!1,isPublished:!1,resourceName:a})}})),S.next=16,n.a.awrap(Promise.all(p));case 16:if(d=S.sent,e!==W.PUBLISHING){S.next=25;break}return f=o.itemResourcesToPublish.map((function(e){if("expressmap"===e.type)return t.copyVersionedItemResource(e.id,K.DRAFT,K.PUBLISHED)})),S.next=21,n.a.awrap(Promise.all(Object(s.a)(f)));case 21:b=S.sent,d=d.concat(b),S.next=31;break;case 25:if(e!==W.DISCARDING_UNPUBLISHED_CHANGES){S.next=31;break}return h=o.publishedItemResources.map((function(e){if("expressmap"===e.type)return t.copyVersionedItemResource(e.id,K.PUBLISHED,K.DRAFT)})),S.next=29,n.a.awrap(Promise.all(Object(s.a)(h)));case 29:m=S.sent,d=d.concat(m);case 31:return S.abrupt("return",d);case 32:case"end":return S.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"copyVersionedItemResource",(function(e,r,a){var s,i;return n.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return s=t.getVersionedItemResourceUrl(e,r),o.next=3,n.a.awrap(Object(v.c)(s,{authentication:t.userSession}));case 3:return i=o.sent,o.abrupt("return",t.upsertItemResource({isPublished:a===K.PUBLISHED,resourceName:Object(D.e)(e,a),resource:Object(I.c)(i)}));case 5:case"end":return o.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"getResourceIdsFromData",(function(e,r,a){var s,i,o,c;return n.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return s=[],i=e.map((function(e){return"expressmap"===e.type?(r===K.PUBLISHED&&a===W.PUBLISHING?s.push(t.getExpressMapItemResources(e.id,K.DRAFT)):r===K.DRAFT&&a===W.DISCARDING_UNPUBLISHED_CHANGES?s.push(t.getExpressMapItemResources(e.id,K.PUBLISHED)):s.push(t.getExpressMapItemResources(e.id,r)),Object(D.e)(e.id,r)):e.id}),[]),u.next=4,n.a.awrap(Promise.all(s));case 4:return o=u.sent,c=o.reduce((function(e,t){return e.concat(t)}),i),u.abrupt("return",c);case 7:case"end":return u.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"upsertOembedResources",(function(e){var r,s,i,o,c,u;return n.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,n.a.awrap(a.fetchItemDetails({itemId:t.itemId,userSession:t.userSession,portalHost:t.config.PORTAL_HOST}));case 2:return r=l.sent,t.setItemDetails(r),s=Object(E.b)(t.config.PORTAL_HOST,t.itemDetails,"".concat(location.origin).concat(t.config.BASE_URL,"/static/images/builder/item/default-thumbnail.jpg?w=400")),i=s.substring(0,s.indexOf("?")),l.next=8,n.a.awrap(Object(R.a)(i));case 8:return(o=l.sent).height=400*o.height/o.width,o.width=400,c={version:"1.0",type:"rich",title:t.itemDetails.title,url:t.itemDetails.url,author_name:t.itemDetails.byline,provider_name:"".concat(k.e),provider_url:new URL(t.itemDetails.url).origin,width:800,height:600,thumbnail_url:"".concat(i),thumbnail_height:"".concat(o.height),thumbnail_width:"".concat(o.width),html:'<iframe src="'.concat(t.itemDetails.url,'" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen></iframe>'),cache_age:86400},u='<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n    <oembed>\n      <version>1.0</version>\n      <type>rich</type>\n      <title>'.concat(t.itemDetails.title,"</title>\n      <url>").concat(t.itemDetails.url,"</url>\n      <author_name>").concat(t.itemDetails.byline,"</author_name>\n      <provider_name>").concat(k.e,"</provider_name>\n      <provider_url>").concat(new URL(t.itemDetails.url).origin,"</provider_url>\n      <width>800</width>\n      <height>600</height>\n      <thumbnail_url>").concat(i,"</thumbnail_url>\n      <thumbnail_height>").concat(o.height,"</thumbnail_height>\n      <thumbnail_width>").concat(o.width,'</thumbnail_width>\n      <html><iframe src="').concat(t.itemDetails.url,'" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen="true"></iframe></html>\n      <cache_age>86400</cache_age>\n    </oembed>\n    '),l.next=15,n.a.awrap(Promise.all([t.upsertItemResource({isAdd:!0,isPublished:!0,resourceName:"oembed.json",resource:Object(I.c)(c)},e),t.upsertItemResource({isAdd:!0,isPublished:!0,resourceName:"oembed.xml",resource:new Blob([u],{type:"text/xml"})},e)]));case 15:case"end":return l.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"getExpressMapItemResources",(function(e,r){var a,s;return n.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.getVersionedItemResourceUrl(e,r),i.next=3,n.a.awrap(Object(v.c)(a,{authentication:t.userSession}));case 3:return s=i.sent,i.abrupt("return",Object.keys(s.popups).reduce((function(e,t){var r=s.popups[t];return r.image&&"string"===typeof r.image?e.concat(r.image):e}),[]));case 5:case"end":return i.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(c.a)(t),"getVersionedItemResourceUrl",(function(e,r){return"".concat(Object(E.e)(t.config.PORTAL_HOST,t.userSession),"/content/items/").concat(t.itemId,"/resources/").concat(Object(D.e)(e,r))})),Object(f.a)(Object(c.a)(t),"defaultWindowUnloadEvent",(function(e){e.preventDefault(),e.returnValue=""})),Object(f.a)(Object(c.a)(t),"downloadDraftRecoveryFileFromConsole",(function(){Z(t.itemId)||console.error("No draft recovery file available for download.")})),window.downloadDraftRecoveryFile=t.downloadDraftRecoveryFileFromConsole,t}return Object(o.a)(a,[{key:"setItemPublishStatus",value:function(e){var t=this.itemDetails.typeKeywords.filter((function(e){return e!==C.c.draft&&e!==C.c.published&&e!==C.c.unpublishedChanges&&"status:draft"!==e&&"status:published"!==e&&"status:unpublished-changes"!==e}));this.setItemDetails(q({},this.itemDetails,{typeKeywords:[].concat(Object(s.a)(t),[e])}))}},{key:"updateAppVersion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DRAFT_SAVE,t=e===W.PUBLISHING||e===W.UNPUBLISHING?C.a.published:C.a.draft,r=this.itemDetails.typeKeywords.filter((function(e){return 0!==e.search(t)}));e===W.UNPUBLISHING?this.setItemDetails(q({},this.itemDetails,{typeKeywords:r})):this.setItemDetails(q({},this.itemDetails,{typeKeywords:[].concat(Object(s.a)(r),["".concat(t,":").concat(this.config.APP_VERSION)])}))}},{key:"setItemDraftData",value:function(e){var t=_.a.sanitize(e,{allowUndefined:!0});this._itemDraftData=t,this.itemDraftDataJSON=JSON.stringify(t)}},{key:"setItemPublishDate",value:function(e){var t=this.itemDetails.typeKeywords.filter((function(e){return!e.match(C.e.publishedDate)}));"remove"===e?this.setItemDetails(q({},this.itemDetails,{typeKeywords:Object(s.a)(t)})):this.setItemDetails(q({},this.itemDetails,{typeKeywords:[].concat(Object(s.a)(t),["".concat(C.e.publishedDate,":").concat(new Date(e).getTime())])}))}},{key:"itemDraftData",get:function(){return this._itemDraftData},set:function(e){if(this._itemDraftData)throw new Error("Item draft data have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemDraftData(e)}}]),a}(U.b);Object(f.a)(Q,"fetchItemDraftData",(function(e){var t,r,a;return n.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,n.a.awrap(Object(g.a)({itemDetails:e.itemDetails,portalHost:e.portalHost,userSession:e.userSession}));case 3:if(t=s.sent,!Q.validateItemData(e.type,t)){s.next=6;break}return s.abrupt("return",t);case 6:throw t;case 9:if(s.prev=9,s.t0=s.catch(0),404!==s.t0.code){s.next=16;break}throw r=z(e.itemDetails.id),a=new H(e.itemDetails.id,r&&r.data?r&&r.data:void 0),j.a.trackEvent(j.a.Category.Error,j.a.Action.Error_DraftDataMissing),a;case 16:throw s.t0;case 17:case"end":return s.stop()}}),null,null,[[0,9]],Promise)}));t.a=Q},DeSy:function(e,t,r){"use strict";var a,n;r.d(t,"d",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return o})),function(e){e.STORY_MAP="storymap",e.WEBMAP="webmap",e.WEBSCENE="webscene",e.MAP_LAYER="map-layer"}(a||(a={})),function(e){e.ARCGIS_STREAM_LAYER="ArcGISStreamLayer",e.BING_AERIAL_LAYER="BingMapsAerial",e.BING_ROAD_LAYER="BingMapsRoad",e.BING_HYBRID_LAYER="BingMapsHybrid",e.BUILDING_SCENE_LAYER="BuildingSceneLayer",e.CSV_LAYER="CSV",e.ELEVATION_LAYER="ArcGISTiledElevationServiceLayer",e.FEATURE_LAYER="ArcGISFeatureLayer",e.GEO_RSS_LAYER="GeoRSS",e.GROUP_LAYER="GroupLayer",e.IMAGE_SERVICE_LAYER="ArcGISImageServiceLayer",e.IMAGE_SERVICE_VECTOR_LAYER="ArcGISImageServiceVectorLayer",e.INTEGRATED_MESH_LAYER="IntegratedMeshLayer",e.KML_LAYER="KML",e.MAP_SERVICE_LAYER="ArcGISMapServiceLayer",e.OPEN_STREET_MAP_LAYER="OpenStreetMap",e.POINT_CLOUD_LAYER="PointCloudLayer",e.SCENE_LAYER="ArcGISSceneServiceLayer",e.TILED_IMAGE_SERVICE_LAYER="ArcGISTiledImageServiceLayer",e.TILED_MAP_SERVICE_LAYER="ArcGISTiledMapServiceLayer",e.VECTOR_TILE_LAYER="VectorTileLayer",e.WEB_FEATURE_SERVICE_LAYER="WFS",e.WEB_TILE_LAYER="WebTiledLayer",e.WMS_LAYER="WMS"}(n||(n={}));var s=new Error("The issue cannot be automatically fixed"),i=new Error("App cannot be registered. Registration must be provided"),o=new Error("No app proxy information provided")},"I/HP":function(e,t,r){"use strict";r.d(t,"b",(function(){return S})),r.d(t,"a",(function(){return y}));var a=r("VtSi"),n=r.n(a),s=r("zjfJ"),i=r("HbGN"),o=r("79uv"),c=r("Z34l"),u=r("kO5H"),l=r("fQV3"),p=r("Bx5b");function d(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,s=!0,i=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return s=e.done,e},e:function(e){i=!0,n=e},f:function(){try{s||null==a.return||a.return()}finally{if(i)throw n}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(s.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=function(e){return/^draft(?:_\d+)?.json$/.test(e)},S=function(e){return Object(u.a)({itemDetails:e,typekeywordId:p.a})||"draft.json"},y=function(e){var t,r,a,s,p,f,b,y,v;return n.a.async((function(I){for(;;)switch(I.prev=I.next){case 0:return t=e.itemDetails,r=Object(i.a)(e,["itemDetails"]),I.prev=1,a=S(t),I.next=5,n.a.awrap(Object(o.a)(h({},r,{itemId:e.itemDetails.id,resourceId:a})));case 5:return I.abrupt("return",I.sent);case 8:if(I.prev=8,I.t0=I.catch(1),!Object(u.b)(t)){I.next=15;break}return I.next=13,n.a.awrap(Object(l.b)(e.itemDetails.id,{authentication:e.userSession}));case 13:return s=I.sent,I.abrupt("return",h({},s,{title:t.title,snippet:t.snippet}));case 15:return I.next=17,n.a.awrap(Object(o.b)({userSession:e.userSession,username:e.itemDetails.owner,itemId:e.itemDetails.id,portal:Object(c.e)(e.portalHost,e.userSession)}));case 17:p=I.sent,f=p.filter((function(e){return m(e.resource)})).sort().reverse(),b=d(f),I.prev=20,b.s();case 22:if((y=b.n()).done){I.next=34;break}return v=y.value,I.prev=24,I.next=27,n.a.awrap(Object(o.a)(h({},r,{itemId:e.itemDetails.id,resourceId:v.resource})));case 27:return I.abrupt("return",I.sent);case 30:I.prev=30,I.t1=I.catch(24);case 32:I.next=22;break;case 34:I.next=39;break;case 36:I.prev=36,I.t2=I.catch(20),b.e(I.t2);case 39:return I.prev=39,b.f(),I.finish(39);case 42:throw I.t0;case 43:case"end":return I.stop()}}),null,null,[[1,8],[20,36,39,42],[24,30]],Promise)}},Q1mh:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r("D57K"),n=r("ZcpU"),s=r("11In");function i(e){var t=Object(s.a)(e);return Object(s.c)(e)?o(t,e):Object(s.d)(e).then((function(r){if(r)return o(t,e);throw Error("This item can not be shared by "+e.authentication.username+". They are neither the item owner nor an organization admin.")}))}function o(e,t){return t.params=a.a({org:!1,everyone:!1},t.params),"private"===t.access&&(t.params.groups=" "),"org"===t.access&&(t.params.org=!0),"public"===t.access&&(t.params.account=!0,t.params.everyone=!0),Object(n.c)(e,t)}},"R+Fi":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r("VtSi"),n=r.n(a),s=r("Z34l"),i=function(e){var t,r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.userSession,r=e.isStoryOwner,a.next=3,n.a.awrap(r());case 3:if(a.t0=a.sent,a.t0){a.next=8;break}return a.next=7,n.a.awrap(Object(s.h)({userSession:t,requiredPrivileges:["portal:admin:reassignItems"],requiresAll:!1}));case 7:a.t0=a.sent;case 8:if(!a.t0){a.next=10;break}return a.abrupt("return",!0);case 10:return a.abrupt("return",!1);case 11:case"end":return a.stop()}}),null,null,null,Promise)}},S15H:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"c",(function(){return h})),r.d(t,"e",(function(){return m})),r.d(t,"b",(function(){return v})),r.d(t,"d",(function(){return I}));var a=r("VtSi"),n=r.n(a),s=r("N8kh"),i=r("79uv"),o=r("Q1mh"),c=r("vpyF"),u=r("DeSy");function l(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,s=!0,i=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return s=e.done,e},e:function(e){i=!0,n=e},f:function(){try{s||null==a.return||a.return()}finally{if(i)throw n}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var d=function(e,t){var r,a,n;return("admin"===(null===(r=e.userMembership)||void 0===r?void 0:r.memberType)||"owner"===(null===(a=e.userMembership)||void 0===a?void 0:a.memberType)||!e.isViewOnly&&"member"===(null===(n=e.userMembership)||void 0===n?void 0:n.memberType))&&(!t&&(!e.capabilities||!e.capabilities.includes("updateitemcontrol"))||!!t)},f=function(e){var t,r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.requiredSharingLevel.groups&&0!==e.requiredSharingLevel.groups.length){a.next=2;break}return a.abrupt("return",!1);case 2:if(!e.isNestedItem||e.itemDetails.access!==s.a.PUBLIC&&e.requiredSharingLevel.access!==s.a.PUBLIC){a.next=4;break}return a.abrupt("return",!1);case 4:return a.next=6,n.a.awrap(Object(i.d)({itemDetails:e.itemDetails,userSession:e.userSession}));case 6:if(t=a.sent,0!==(r=e.requiredSharingLevel.groups.filter((function(e){return!t.includes(e)}))).length){a.next=10;break}return a.abrupt("return",!1);case 10:return a.abrupt("return",r);case 11:case"end":return a.stop()}}),null,null,null,Promise)},b=function(e){var t,r,a,i,o;return n.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if("update"===(u=e.itemDetails).itemControl||"admin"===u.itemControl||e.itemDetails.access===s.a.PUBLIC){c.next=2;break}return c.abrupt("return",!1);case 2:return c.next=4,n.a.awrap(e.userSession.getUser());case 4:if(t=c.sent,e.requiredSharingLevel.access!==s.a.ORG||!(e.storyMapUserPrivileges&&!e.storyMapUserPrivileges.canShareOrg||!e.storyMapUserPrivileges&&t.privileges&&t.privileges.indexOf("portal:user:shareToOrg")<0&&t.privileges.indexOf("portal:admin:shareToOrg")<0)){c.next=7;break}return c.abrupt("return",!1);case 7:if(e.requiredSharingLevel.access!==s.a.PUBLIC||!(e.storyMapUserPrivileges&&!e.storyMapUserPrivileges.canSharePublic||!e.storyMapUserPrivileges&&t.privileges&&t.privileges.indexOf("portal:user:shareToPublic")<0&&t.privileges.indexOf("portal:admin:shareToPublic")<0)){c.next=9;break}return c.abrupt("return",!1);case 9:if(!(e.requiredSharingLevel.groups&&e.requiredSharingLevel.groups.length>0&&(e.storyMapUserPrivileges&&!e.storyMapUserPrivileges.canShareToGroup||!e.storyMapUserPrivileges&&t.privileges&&t.privileges.indexOf("portal:user:shareToGroup")<0&&t.privileges.indexOf("portal:admin:shareToGroup")<0))){c.next=11;break}return c.abrupt("return",!1);case 11:if(!e.newRequiredGroups){c.next=30;break}r=l(e.newRequiredGroups),c.prev=13,i=function(){var e,r=a.value,n=null===(e=t.groups)||void 0===e?void 0:e.find((function(e){return e.id===r}));if(!n||!d(n))return{v:!1}},r.s();case 16:if((a=r.n()).done){c.next=22;break}if("object"!==typeof(o=i())){c.next=20;break}return c.abrupt("return",o.v);case 20:c.next=16;break;case 22:c.next=27;break;case 24:c.prev=24,c.t0=c.catch(13),r.e(c.t0);case 27:return c.prev=27,r.f(),c.finish(27);case 30:return c.abrupt("return",!0);case 31:case"end":return c.stop()}var u}),null,null,[[13,24,27,30]],Promise)},h=function(e){return e.typeKeywords.indexOf("Requires Credits")>=0},m=function(e){return e.typeKeywords.indexOf("Requires Subscription")>=0},S=function(e){try{var t=new URL(e);return t.origin+t.pathname.replace(/\/\d*$/,"")}catch(r){return e}},y=function(e,t){try{var r=t.rules.sharing.appProxy.existingAppProxy.proxies.filter((function(t){return e===t.sourceUrl})).length>0,a=t.rules.sharing.appProxy.serviceProxyParams.referrers.filter((function(e){return!t.rules.sharing.appProxy.existingAppProxy.referrers.includes(e)})).length>0;return r&&!a}catch(n){return!1}},v=function(e,t){var r,a,i,l,p,d,v,I,g,O,w,P,D;return n.a.async((function(j){for(;;)switch(j.prev=j.next){case 0:if(a={access:e.access},i=(null===(r=t.rules.sharing)||void 0===r?void 0:r.requiredSharingLevel)?t.rules.sharing.requiredSharingLevel:{access:e.access},l=[s.a.PRIVATE,s.a.SHARED,s.a.ORG,s.a.PUBLIC],t.item.type!==u.d.MAP_LAYER||i.access!==s.a.PUBLIC){j.next=12;break}if(p=h(e),d=m(e),v=S(e.url),!p&&!d||y(v,t)){j.next=12;break}return I=!!(t.rules.sharing&&t.rules.sharing.appProxy&&t.rules.sharing.appProxy.isAppAdmin&&(t.rules.sharing.appProxy.isRegisteredApp||!t.rules.sharing.appProxy.isRegisteredApp&&t.rules.sharing.appProxy.registerAppParams&&t.rules.sharing.appProxy.registerAppParams.redirect_uris.length>0)),(g={hasIssue:!0,sharingLevel:a,issue:{type:"app-proxy-required",hasFix:I,severity:"error",isPremiumContent:p,isSubscriberContent:d}}).issue.hasFix&&(g.issue.fix={type:"app-proxy",sourceUrl:v}),j.abrupt("return",g);case 12:return O=l.indexOf(a.access)>=l.indexOf(i.access),j.next=15,n.a.awrap(f({isNestedItem:!!t.isNestedItem,itemDetails:e,requiredSharingLevel:i,userSession:t.userSession}));case 15:if(w=j.sent,O&&!w){j.next=23;break}return j.next=19,n.a.awrap(b({itemDetails:e,requiredSharingLevel:i,newRequiredGroups:w,userSession:t.userSession,storyMapUserPrivileges:t.storyMapUserPrivileges}));case 19:return P=j.sent,D={hasIssue:!0,sharingLevel:a,issue:{type:"sharing-access-level",severity:"error",requiredSharingLevel:i,currentSharingLevel:a,hasFix:P}},P&&(D.issue.fix=function(){var r;return n.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return r=[],O||r.push(Object(o.a)({authentication:t.userSession,id:e.id,access:i.access===s.a.SHARED?s.a.PRIVATE:i.access,owner:e.owner})),!1!==w&&w.forEach((function(a){var n;r.push(Object(c.a)({id:e.id,groupId:a,confirmItemControl:null===(n=t.rules.sharing)||void 0===n?void 0:n.allowSharingToUpdateGroups,authentication:t.userSession,owner:e.owner}))})),a.next=5,n.a.awrap(Promise.all(r));case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),null,null,null,Promise)}),j.abrupt("return",D);case 23:return j.abrupt("return",{hasIssue:!1,sharingLevel:a});case 24:case"end":return j.stop()}}),null,null,null,Promise)},I=function(e){return e.typeKeywords&&e.typeKeywords.includes("Registered App")}},n32U:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var a=r("zygG"),n=function(e){return new Promise((function(t,r){var a=new Image;a.onload=function(){t({height:a.naturalHeight,width:a.naturalWidth})},a.onerror=function(){r("image-load-error")},a.src=e}))},s=function(e,t,r,n){return new Promise((function(s,i){var o=new Image;o.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d");if(!i)return s("");var c="number"===typeof r?[r,r]:r,u=Object(a.a)(c,2),l=u[0],p=u[1],d=0,f=0,b=o.width/o.height,h=l/p;if("contain"===t?b<=h?(f=p,d=p*b):(d=l,f=l/b):"cover"===t&&(b<=h?(d=l,f=l/b):(f=p,d=p*b)),"cover"===t&&n){var m=b>h?.5*(l-d):0,S=b<=h?.5*(p-f):0;e.width=l,e.height=p,i.drawImage(o,m,S,d,f)}else e.width=d,e.height=f,i.drawImage(o,0,0,d,f);return s(e.toDataURL())},o.onerror=function(){return s("")},o.src=e}))}}}]);