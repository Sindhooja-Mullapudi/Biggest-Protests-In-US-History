(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{uDpm:function(e,t,a){"use strict";a.r(t),a.d(t,"ImmersiveSlide",(function(){return re}));var n=a("cxan"),r=a("VtSi"),i=a.n(r),s=a("zygG"),o=a("9fIP"),c=a("MMYH"),d=a("pWxA"),u=a("PRnZ"),l=a("K/z8"),p=a("sRHE"),h=a("8K1b"),f=a("zjfJ"),g=a("ERkP"),b=a.n(g),m=a("g2IE"),v=a("txt0"),y=a("EJc+"),k=a("2WDw"),x=a("h0mi"),w=a("O8Oa"),P=a("o31f"),I=a("Xls9"),O=a("6Fw+"),M=a("yFcC"),S=a.n(M),j=a("2SGB"),A=a("YQpL"),B=a("O94r"),C=a.n(B),E=a("Z4N4"),T=a("NX3A"),L=a("tSRP"),R=a("wWnZ"),D=a("33+R"),N=a("A7aE"),V=a("MmJo"),U=a("mY2J"),z=a("cCzZ"),_=a("+d95"),F=a("2EIY"),G=b.a.createElement;function H(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var W=function(e){Object(h.a)(r,e);var t,a=(t=r,function(){var e,a=Object(p.a)(t);if(H()){var n=Object(p.a)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return Object(l.a)(this,e)});function r(){var e;Object(o.a)(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),Object(f.a)(Object(d.a)(e),"drodownButtonStyles",{styles:G(S.a,{id:"574980970",dynamic:[E.a.shadow.sm()]},[".dropdown-button.__jsx-style-dynamic-selector{".concat(E.a.shadow.sm(),";}")]),className:S.a.dynamic([["574980970",[E.a.shadow.sm()]]])}),Object(f.a)(Object(d.a)(e),"renderExternalMediaPicker",(function(){var t=Object(_.a)(e.props.storyDesign.storyTheme.themeVariables,e.props.backgroundColor);return 0===g.Children.count(e.props.children)&&e.props.isSelected&&G("div",{className:S.a.dynamic([["2075205069",[E.a.gapped("column","0.2rem"),T.a.spacing.xs]]])+" dropdown-container"},G(U.a,{items:e.props.blockItems,renderTarget:e.renderMediaDropdownTarget,source:e.props.source,placement:"bottom-start"}),e.props.canHaveBackgroundColor&&G(b.a.Fragment,null,G(L.a,{target:G(V.a,{className:C()("dropdown-button",e.drodownButtonStyles.className),color:t,backgroundColor:T.a.color.splashedWhite,ariaLabel:e.props.intl.formatMessage({id:"builder.mediaPanel.backgroundColor.dropdown.label"})}),popper:G(P.b,{selectedStyle:t,onStyleSelected:e.onColorSelected}),hideOnContentClick:!1,placement:"bottom-start"}),e.drodownButtonStyles.styles),G(S.a,{id:"2075205069",dynamic:[E.a.gapped("column","0.2rem"),T.a.spacing.xs]},[".dropdown-container.__jsx-style-dynamic-selector{".concat(E.a.gapped("column","0.2rem"),";-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;position:absolute;z-index:0;top:").concat(T.a.spacing.xs,";left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);pointer-events:auto;}")]))})),Object(f.a)(Object(d.a)(e),"renderMediaDropdownTarget",(function(t){return G("div",null,G(R.a,{className:C()("dropdown-button",e.drodownButtonStyles.className),type:"full",color:"light",onClick:t,icon:G(D.a,{height:T.a.spacing.xxs,width:"auto"}),iconPosition:"end"},G(j.a,{id:"builder.tour.addMedia"}),e.drodownButtonStyles.styles))})),Object(f.a)(Object(d.a)(e),"onColorSelected",(function(t){"function"===typeof e.props.onBackgroundColorSelected&&e.props.onBackgroundColorSelected(t)})),e}return Object(c.a)(r,[{key:"render",value:function(){return G(b.a.Fragment,null,G(F.a,Object(n.a)({},this.props,{appendedUI:this.renderExternalMediaPicker()}),G(z.default,{backgroundColor:this.props.backgroundColor},this.props.children)))}}]),r}(g.PureComponent),J=Object(N.b)(Object(A.c)(W)),X=a("cuUk"),Y=a("+PoS");function Z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var K=function(e){Object(h.a)(n,e);var t,a=(t=n,function(){var e,a=Object(p.a)(t);if(Z()){var n=Object(p.a)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return Object(l.a)(this,e)});function n(e){Object(o.a)(this,n);return a.call(this,e,{iconName:"sound-off",path:"M25.514 2.941l-.753.658a20.238 20.238 0 0 1 .97 23.424l-3.839-3.838A13.446 13.446 0 0 0 24 15.984a12.97 12.97 0 0 0-3.468-8.865l-.717.698A12.017 12.017 0 0 1 23 15.983a12.449 12.449 0 0 1-1.829 6.48L16 17.294V7.14a.68.68 0 0 0-1.075-.554l-5.327 4.305-6.119-6.119-.707.707 24.749 24.749.707-.707-1.78-1.78a21.217 21.217 0 0 0-.934-24.8zM15 7.811v8.482l-4.691-4.691zm0 12.017l1 1v4.032a.68.68 0 0 1-1.075.554L8.225 20h-4.39A1.834 1.834 0 0 1 2 18.166v-4.332A1.834 1.834 0 0 1 3.834 12h3.337l1 1H3.834a.836.836 0 0 0-.834.835v4.33a.835.835 0 0 0 .834.835H8.58L15 24.19z",viewBox:"0 0 32 32"})}return n}(a("MEC2").a),q=b.a.createElement,Q=Object(g.memo)((function(e){var t={styles:q(S.a,{id:"835798159",dynamic:[T.a.spacing.xxxs]},[".icon.__jsx-style-dynamic-selector::after{content:'';margin-right:".concat(T.a.spacing.xxxs,";}")]),className:S.a.dynamic([["835798159",[T.a.spacing.xxxs]]])};return q("div",{role:"button",onClick:e.onClick,className:S.a.dynamic([["27753971",[T.a.spacing.xxxxs,E.a.hexA(T.a.color.black,.7),T.a.color.white,T.a.spacing.xs,T.a.spacing.xxxs,T.a.spacing.xxs,E.a.typography.body14(),E.a.center()]]])+" toggle"},q(K,{color:T.a.color.white,height:T.a.spacing.xxs,width:T.a.spacing.xxs,className:t.className}),q(j.a,{id:"builder.backgroundAudio.unmute.tooltip"}),t.styles,q(S.a,{id:"27753971",dynamic:[T.a.spacing.xxxxs,E.a.hexA(T.a.color.black,.7),T.a.color.white,T.a.spacing.xs,T.a.spacing.xxxs,T.a.spacing.xxs,E.a.typography.body14(),E.a.center()]},[".toggle.__jsx-style-dynamic-selector{pointer-events:auto;border-radius:".concat(T.a.spacing.xxxxs,";background-color:").concat(E.a.hexA(T.a.color.black,.7),";color:").concat(T.a.color.white,";max-width:24rem;margin:").concat(T.a.spacing.xs," auto 0;padding:").concat(T.a.spacing.xxxs," ").concat(T.a.spacing.xxs,";text-align:center;").concat(E.a.typography.body14(),";").concat(E.a.center(),";}"),".toggle.__jsx-style-dynamic-selector:hover{cursor:pointer;}"]))})),$=a("eytW"),ee=b.a.createElement;function te(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?te(Object(a),!0).forEach((function(t){Object(f.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):te(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ne(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var re=function(e){Object(h.a)(g,e);var t,r=(t=g,function(){var e,a=Object(p.a)(t);if(ne()){var n=Object(p.a)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return Object(l.a)(this,e)});function g(e){var t,a,n,c,u,l,p,h,b;Object(o.a)(this,g),b=r.call(this,e),Object(f.a)(Object(d.a)(b),"insertAudioResource",(function(e){var t,a,n,r,o,c,u,l,p,h,f,g;return i.a.async((function(y){for(;;)switch(y.prev=y.next){case 0:if(a=b.getGlobalState("storyItem")){y.next=3;break}throw new Error("Background audio upload failed");case 3:if(n=Object(m.a)(e.data.src),r=Object(X.d)(n,"audio"),r.isValid){y.next=7;break}throw new Error("Background audio upload failed");case 7:return o=Object($.a)(e.data.name,n.type),c=Object(s.a)(o,2),u=c[0],l=c[1],p={resourceName:u,resource:n,isAdd:!0},y.next=11,i.a.awrap(a.upsertItemResource(p));case 11:return h={provider:"item-resource",resourceId:u},y.next=14,i.a.awrap(b.insertResource({type:"audio",data:h,root:Object(d.a)(b)}));case 14:if(void 0===typeof(f=y.sent)){y.next=20;break}return b.backgroundAudio=f,b.data.backgroundAudio={id:b.backgroundAudio.id},y.next=20,i.a.awrap(b.update());case 20:return g="mp3"===l?v.a.Name.Audio_MP3:"mpeg"===l?v.a.Name.Audio_MPEG:v.a.Name.Audio_WAV,v.a.trackEvent(v.a.Category.Builder,v.a.Action.Builder_InsertImmersiveBackgroundAudio,g),y.next=24,i.a.awrap(null===(t=b.parent)||void 0===t?void 0:t.do("onBackgroundAudioUploaded"));case 24:case"end":return y.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"toggleIsBackgroundAudioMuted",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return b.setGlobalState("background-audio-muted",!b.getIsBackgroundAudioMuted()),b.states.isPlayingBackgroundAudio=!b.getIsBackgroundAudioMuted(),e.next=4,i.a.awrap(b.update({skipSave:!0}));case 4:case"end":return e.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"deleteBackgroundAudio",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b.backgroundAudio){e.next=5;break}return b.backgroundAudio=void 0,delete b.data.backgroundAudio,e.next=5,i.a.awrap(b.update());case 5:case"end":return e.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"playBackgroundMedia",(function(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(b.childrenIds.length>1)){t.next=5;break}if(!(e=b.getMediaPanelBlock())||"video"!==e.type){t.next=5;break}return t.next=5,i.a.awrap(e.do("play"));case 5:return b.states.isPlayingBackgroundAudio=!b.getIsBackgroundAudioMuted(),t.next=8,i.a.awrap(b.update({skipSave:!0}));case 8:case"end":return t.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"pauseBackgroundMedia",(function(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(b.childrenIds.length>1)){t.next=5;break}if(!(e=b.getMediaPanelBlock())||"video"!==e.type){t.next=5;break}return t.next=5,i.a.awrap(e.do("pause"));case 5:return b.states.isPlayingBackgroundAudio=!1,t.next=8,i.a.awrap(b.update({skipSave:!0}));case 8:case"end":return t.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"setMediaPanelMediaStates",(function(e){e.states.isCropped=!0,e.states.hasLayout=!1,e.states.showCaption=!1,e.states.showFullToolbar=!1,e.states.fillParent=!0,e.states.hasLoadingIndicator=!0,e.states.loadingBackgroundColor=b.data.backgroundColor,e.states.showFullScreenButton="slideshow"===b.states.immersiveType,e.states.isShowingVideoPlayerControls=!1})),Object(f.a)(Object(d.a)(b),"onBackgroundColorSelected",(function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return b.data.backgroundColor=e,t.next=3,i.a.awrap(b.update());case 3:b.onMediaItemUpdated();case 4:case"end":return t.stop()}}),null,null,null,Promise)})),Object(f.a)(Object(d.a)(b),"getMediaPanelMediaType",(function(){var e=b.getMediaPanelBlock();return e?e.type:b.data.backgroundColor?"background-color":void 0})),Object(f.a)(Object(d.a)(b),"getMediaPanelMediaResourceId",(function(){var e=b.getMediaPanelBlock();if(e)return e.do("getMediaId")})),Object(f.a)(Object(d.a)(b),"getMediaPanelBlock",(function(){var e=b.childrenIds[1];if(e){var t=b.childrenNodes[e];if(t&&"immersive-media-panel"!==t.type)return t}})),Object(f.a)(Object(d.a)(b),"getChildBlockIdAt",(function(e){var t;return null===(t=b.getChildrenBlocks()[e])||void 0===t?void 0:t.id})),Object(f.a)(Object(d.a)(b),"isFirstVisibleSlide",(function(){return!!b.parent&&b.getIndex()===b.parent.do("getFirstVisibleChildIndex")})),Object(f.a)(Object(d.a)(b),"getIsBackgroundAudioMuted",(function(){return b.getGlobalState("background-audio-muted")})),Object(f.a)(Object(d.a)(b),"canDuplicate",(function(){return"expressmap"!==b.getMediaPanelMediaType()||b.getFeatureDecisions().TEMP_canDuplicateExpressMap})),b.data.transition||(b.data.transition="fade"),"undefined"!==typeof b.data.backgroundAudio&&(b.backgroundAudio=b.getResourceById(b.data.backgroundAudio.id)),b.states.immersiveType=(null===(t=b.parent)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.type)?b.parent.data.type:"sidecar";var y=null===(n=b.parent)||void 0===n?void 0:null===(c=n.data)||void 0===c?void 0:c.subtype;b.states.immersiveSubtype=y||void 0,"slideshow"!==b.states.immersiveType||b.data.backgroundColor||(b.data.backgroundColor=P.a.lightGray.color),b.states.isActive=!1,b.states.isSelected=!1,b.states.isTransitionAnimated=!0,b.states.isBackgroundAudioDisabled="slideshow"===b.states.immersiveType;var k=null===(u=b.parent)||void 0===u?void 0:null===(l=u.data)||void 0===l?void 0:l.narrativePanelPosition;b.states.dockedNarrativePanelPosition=k||"start";var x=null===(p=b.parent)||void 0===p?void 0:null===(h=p.data)||void 0===h?void 0:h.narrativePanelSize;return b.states.dockedNarrativePanelSize=x||"small",b.addEventListener("updateActive",(function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isActive===b.states.isActive){t.next=5;break}return b.states.isActive=e.isActive,b.states.isTransitionAnimated=e.isTransitionAnimated,t.next=5,i.a.awrap(b.update({skipSave:!0}));case 5:case"end":return t.stop()}}),null,null,null,Promise)})),b.addEventListener("onPanelThresholdHit",(function(e){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!b.parent||e===b.states.isActive){a.next=9;break}if(t=b.getIndex(),!e){a.next=7;break}return a.next=5,i.a.awrap(b.parent.do("onSlideScrolledTo",t));case 5:a.next=9;break;case 7:return a.next=9,i.a.awrap(b.parent.do("onSlideScrolledAway",t));case 9:case"end":return a.stop()}}),null,null,null,Promise)})),b.addEventListener("getImmersiveId",(function(){return b.getImmersiveId()})),b.addEventListener("getMainMediaBlock",(function(){return b.getMediaPanelBlock()})),b.addEventListener("getMediaPanelMediaType",(function(){return b.getMediaPanelMediaType()})),b.addEventListener("getMediaPanelMediaDetailedType",(function(){var e=b.getMediaPanelMediaType();if("webmap"!==e)return e;var t=b.getMediaPanelBlock();return t?t.do("getItemType"):void 0})),b.addEventListener("scrollTo",(function(e){var t=b.childrenNodes[b.childrenIds[0]];t&&t.do("scrollTo",e)})),b.addEventListener("onDocked",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(b.playBackgroundMedia());case 2:case"end":return e.stop()}}),null,null,null,Promise)})),b.addEventListener("onUndocked",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(b.pauseBackgroundMedia());case 2:case"end":return e.stop()}}),null,null,null,Promise)})),b.addEventListener("onSelected",(function(e){var t,a,n,r;return i.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(t=e.isTransitionAnimated,a=e.isDocked,b.states.isSelected=!0,!(n=b.childrenNodes[b.childrenIds[0]])){s.next=6;break}return s.next=6,i.a.awrap(n.do("updateSelected",{isSelected:!0,isTransitionAnimated:t}));case 6:if(!(b.childrenIds.length>1)){s.next=11;break}if(!(r=b.getMediaPanelBlock())){s.next=11;break}return s.next=11,i.a.awrap(r.do("applyProps"));case 11:return s.next=13,i.a.awrap(b.update({skipSave:!0}));case 13:if(!a){s.next=16;break}return s.next=16,i.a.awrap(b.playBackgroundMedia());case 16:case"end":return s.stop()}}),null,null,null,Promise)})),b.addEventListener("onDeselected",(function(e){var t;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(b.states.isSelected=!1,!(t=b.childrenNodes[b.childrenIds[0]])){a.next=5;break}return a.next=5,i.a.awrap(t.do("updateSelected",{isSelected:!1,isTransitionAnimated:e.isTransitionAnimated}));case 5:return a.next=7,i.a.awrap(b.update({skipSave:!0}));case 7:return a.next=9,i.a.awrap(b.pauseBackgroundMedia());case 9:case"end":return a.stop()}}),null,null,null,Promise)})),b.addEventListener("generateThumbnail",(function(){return Object(I.a)({mediaType:b.getMediaPanelMediaType()||"",resourceId:b.getMediaPanelMediaResourceId(),backgroundColor:b.data.backgroundColor,baseUrl:b.getAppConfig().BASE_URL})})),b.addEventListener("onImageUploaded",(function(){b.onMediaItemUpdated()})),b.addEventListener("onTransitionUpdated",(function(e){b.data.transition=e,b.isDirty=!0})),b.addEventListener("duplicate",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b.parent){e.next=3;break}return e.next=3,i.a.awrap(b.parent.do("duplicateSlide",Object(d.a)(b)));case 3:case"end":return e.stop()}}),null,null,null,Promise)})),b.addEventListener("toggleHidden",(function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}return t.next=3,i.a.awrap(b.hide(!1));case 3:t.next=7;break;case 5:return t.next=7,i.a.awrap(b.show(!1));case 7:case"end":return t.stop()}}),null,null,null,Promise)})),b.addEventListener("getNarrativePanelBlockId",(function(){return b.getChildBlockIdAt(0)})),b.addEventListener("getMediaPanelMediaBlockId",(function(){return b.getChildBlockIdAt(1)})),b.addEventListener("getMediaPanelMediaType",(function(){return b.getMediaPanelMediaType()})),b.addEventListener("isFirstVisibleSlide",(function(){return b.isFirstVisibleSlide()})),b.addEventListener("isLastVisibleSlide",(function(){return!b.parent||b.getIndex()===b.parent.do("getLastVisibleChildIndex")})),b.addEventListener("getMediaPanelMediaResourceId",(function(){return b.getMediaPanelMediaResourceId()})),b.addEventListener("getHasSameResourceMediaSibling",(function(){return!!b.states.hasSameResourceMediaSibling})),b.addEventListener("setHasSameResourceMediaSibling",(function(e){var t;"expressmap"===b.getMediaPanelMediaType()&&b.states.hasSameResourceMediaSibling&&!e&&(null===(t=b.getMediaPanelBlock())||void 0===t||t.do("bakeOverridingDataIntoExternalResource"));b.states.hasSameResourceMediaSibling=e})),b.addEventListener("updateSubtypeWithoutUpdate",(function(e){b.states.immersiveSubtype=e,b.isDirty=!0;var t=b.childrenNodes[b.childrenIds[0]];t&&t.do("updateSubtypeWithoutUpdate",e)})),b.addEventListener("getInserterAudioItems",(function(){return b.getInserterBackgroundAudioItems()})),b.addEventListener("getBackgroundAudioSrc",(function(){return b.getBackgroundAudioSrc()})),b.addEventListener("deleteBackgroundAudio",(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(b.deleteBackgroundAudio());case 2:case"end":return e.stop()}}),null,null,null,Promise)})),b}return Object(c.a)(g,[{key:"onNodeAssembled",value:function(){var e,t,a,n,r;return i.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.isFirstVisibleSlide()){s.next=5;break}return this.states.isActive=!0,this.states.isSelected=!0,s.next=5,i.a.awrap(this.update({skipSave:!0}));case 5:if(this.hasChild()){s.next=8;break}return s.next=8,i.a.awrap(this.initImmersiveNarrativePanel());case 8:if(e=this.getGlobalState("storyData")){s.next=11;break}return s.abrupt("return");case 11:if(!this.hasChild()||2!==this.childrenIds.length||1!==Object.keys(this.childrenNodes).length){s.next=22;break}if((t=e.nodes[this.childrenIds[1]])&&"immersive-media-panel"===t.type&&t.data&&t.data.children&&1===t.data.children.length){s.next=15;break}return s.abrupt("return");case 15:return a=t.data.children[0],this.childrenIds[1]=a,n=e.nodes[a],s.next=20,i.a.awrap(this.insertBlock({mode:this.mode,type:n.type,childrenIds:n.children,data:n.data,id:a,parent:this},!1));case 20:(r=s.sent)&&(this.childrenNodes[a]=r);case 22:case"end":return s.stop()}}),null,this,null,Promise)}},{key:"onChildRemoved",value:function(){this.onMediaItemUpdated()}},{key:"getResources",value:function(){var e=[];return"undefined"!==typeof this.backgroundAudio&&e.push(this.backgroundAudio),e}},{key:"getBlockComponent",value:function(){return this.mode===x.a.Viewer?b.a.lazy((function(){return a.e(1).then(a.bind(null,"ECJn"))})):b.a.lazy((function(){return Promise.all([a.e(1),a.e(92)]).then(a.bind(null,"LqrM"))}))}},{key:"getChildrenBlocks",value:function(){var e=Object(u.a)(Object(p.a)(g.prototype),"getChildrenBlocks",this).call(this),t=e[0],a=e[1];return t&&(t.states.viewportOffsetBottom=this.states.viewportOffsetBottom,t.states.dockedPanelPosition=this.states.dockedNarrativePanelPosition,t.states.dockedPanelSize=this.states.dockedNarrativePanelSize,t.states.canDuplicate=this.canDuplicate()),a&&(this.setMediaPanelMediaStates(a),a.placeholder&&this.setMediaPanelMediaStates(a.placeholder)),e}},{key:"getChildrenUI",value:function(){var e,t,a,r,s,o,c,d;return i.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(e=this.getChildrenBlocks(),t=e[0],a=e[1],t){u.next=5;break}return u.abrupt("return",[]);case 5:if(!a||!a.states.shouldRender){u.next=9;break}return u.next=8,i.a.awrap(a.render());case 8:r=u.sent;case 9:return s=this.mode===x.a.Viewer&&this.states.isSelected&&this.getIsBackgroundAudioMuted()&&"undefined"!==typeof this.backgroundAudio,o={key:"".concat(this.id,"-media-panel"),isVisible:this.states.isActive,isTransitionAnimated:this.states.isTransitionAnimated,transition:this.data.transition,position:"sidecar"===this.states.immersiveType&&"docked-panel"===this.states.immersiveSubtype?this.states.dockedNarrativePanelPosition:"start",narrativePanelSize:"sidecar"===this.states.immersiveType&&"docked-panel"===this.states.immersiveSubtype?this.states.dockedNarrativePanelSize:"small",showDropShadow:this.isFirstVisibleSlide(),isFullScreen:"slideshow"===this.states.immersiveType||"sidecar"===this.states.immersiveType&&"floating-panel"===this.states.immersiveSubtype,backgroundColor:"slideshow"===this.states.immersiveType?this.data.backgroundColor:void 0,appendedUI:s&&ee(Q,{onClick:this.toggleIsBackgroundAudioMuted})},c=this.mode===x.a.Viewer?ee(O.a,o,r):ee(J,Object(n.a)({},o,{source:this.states.immersiveType,canHaveBackgroundColor:"slideshow"===this.states.immersiveType,blockItems:this.getMediaPanelInserterItems(),onBackgroundColorSelected:this.onBackgroundColorSelected,isSelected:this.states.isSelected}),r),u.next=14,i.a.awrap(t.render());case 14:return u.t0=u.sent,d=[u.t0],a&&!a.states.shouldRender||(this.getGlobalState("printMode")?d.unshift(c):d.push(c)),u.abrupt("return",d);case 18:case"end":return u.stop()}}),null,this,null,Promise)}},{key:"getViewerProps",value:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.getGlobalState("printMode"),e.next=3,i.a.awrap(this.getChildrenUI());case 3:return e.t1=e.sent,e.t2=this.states.immersiveType,e.t3=this.getBackgroundAudioSrc(),e.t4=this.mode===x.a.Viewer&&this.states.isPlayingBackgroundAudio,e.abrupt("return",{printMode:e.t0,children:e.t1,immersiveType:e.t2,backgroundAudioSrc:e.t3,isPlayingBackgroundAudio:e.t4});case 8:case"end":return e.stop()}}),null,this,null,Promise)}},{key:"getBuilderProps",value:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ae,e.t1={},e.next=4,i.a.awrap(this.getViewerProps());case 4:return e.t2=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 6:case"end":return e.stop()}}),null,this,null,Promise)}},{key:"getLayoutComponent",value:function(){}},{key:"getLayoutProps",value:function(){}},{key:"getInserterAudioItem",value:function(){return this.parent.getInserterItems().find((function(e){return"string"!==typeof e&&"audio"===e.id}))}},{key:"getInserterItems",value:function(){var e=this,t=this.parent.getInserterItems().filter((function(t){return"string"!==typeof t&&("map"===t.id||"sidecar"===e.states.immersiveType&&"embed"===t.id)})),a=Object(k.b)();return t.unshift(a),t}},{key:"getInserterBackgroundAudioItems",value:function(){var e=this,t=this.getInserterAudioItem();if(t)return[ae({onClick:function(){var t,a,n,r=arguments;return i.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},a=t.resourceData,s.prev=1,s.next=4,i.a.awrap(e.insertAudioResource(a));case 4:s.next=9;break;case 6:s.prev=6,s.t0=s.catch(1),null===(n=e.parent)||void 0===n||n.do("onBackgroundAudioUploadFail");case 9:case"end":return s.stop()}}),null,null,[[1,6]],Promise)},type:t.defaultData.type,id:t.id},t.display,{icon:t.display.icon,isDisabled:t.isDisabled})]}},{key:"getBackgroundAudioSrc",value:function(){if(this.backgroundAudio){var e=this.getGlobalState("storyItem");if(!e)return;return Object(Y.a)({storyItem:e,fileName:this.backgroundAudio.data.resourceId,playableMediaType:"audio"})}}},{key:"getMediaPanelInserterItems",value:function(){var e=this;return Object(y.a)({index:1,parent:this,inserterItems:this.getInserterItems(),onInsertedCallback:function(t){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(e.onMediaItemUpdated());case 2:return t.do("showPlaceholderNudge"),a.next=5,i.a.awrap(e.playBackgroundMedia());case 5:e.states.isActive&&t.do("applyProps");case 6:case"end":return a.stop()}}),null,null,null,Promise)}})}},{key:"initImmersiveNarrativePanel",value:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(this.insertBlock({type:"immersive-narrative-panel",parent:this,index:0}));case 2:case"end":return e.stop()}}),null,this,null,Promise)}},{key:"onMediaItemUpdated",value:function(){var e,t,a;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.parent){n.next=3;break}return n.next=3,i.a.awrap(this.parent.do("onMediaPanelMediaUpdated"));case 3:if(e=this.getChildrenBlocks(),!(t=e[0])){n.next=12;break}return n.next=8,i.a.awrap(t.do("onCanDuplicateChanged",this.canDuplicate()));case 8:if("webmap"!==(a=this.getMediaPanelMediaType())&&"undefined"!==typeof a){n.next=12;break}return n.next=12,i.a.awrap(t.do("updateInserterItems"));case 12:case"end":return n.stop()}}),null,this,null,Promise)}},{key:"getImmersiveId",value:function(){if(!this.parent)throw new Error;return this.parent.do("getImmersiveId")}}]),g}(w.a);Object(f.a)(re,"type","immersive-slide"),Object(f.a)(re,"getInstance",(function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new re(Object(w.b)(e,re.type)));case 1:case"end":return t.stop()}}),null,null,null,Promise)}));t.default=re}}]);